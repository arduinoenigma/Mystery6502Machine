pass 2

0000 TODO:  


0000 REM_TO 

0000 REM_IS 

* = $0500
0500 ROLLTB = 004B
0500 GEARAM = 004C
0500 GEAR_W 
0500 ENIGV1 = 004F
0500 ONE_LE 
0500 ENIGVA = 0050
0500 RINGST = 0053
0500 REM_RO 
0500 ROTORS = 0057
0500 REM_RE 
0500 LROTOR = 0058
0500 MROTOR = 0059
0500 RROTOR = 005A
0500 KEYIN  = 005B
0500 KEYOUT = 005C

0500 TIMEO1 = 005D
0500 TMP01  = 005E
0500 TMP02  = 005F
0500 TMP03  = 0060
0500 TMP04  = 0061
0500 TMP05  = 0062
0500 TMP06  = 0063

0500 DISP3  = 00F9

0500 GETKEY = 1F6A
0500 SCANS  = 1F1F

0500        JMP INIT        4C 67 05

0503 GEARTX 
0503 .BYTE $00              00
0504 .BYTE $06              06
0505 .BYTE $0E              0E
0506 .BYTE $0A              0A

0507 DEFVAL 
0507 .BYTE $00              00
0508 .BYTE $01              01
0509 .BYTE $02              02
050A .BYTE $03              03
050B .BYTE $01              01
050C .BYTE $01              01
050D .BYTE $01              01
050E .BYTE $01              01
050F .BYTE $04              04
0510 .BYTE $03              03
0511 .BYTE $02              02
0512 .BYTE $01              01
0513 .BYTE $00              00
0514 .BYTE $00              00

0515 ROTIDX 
0515 .BYTE $1E              1E
0516 .BYTE $00              00
0517 .BYTE $0A              0A
0518 .BYTE $14              14

0519 FWRTR1 
0519 .BYTE $09              09
051A .BYTE $06              06
051B .BYTE $04              04
051C .BYTE $01              01
051D .BYTE $08              08
051E .BYTE $02              02
051F .BYTE $07              07
0520 .BYTE $00              00
0521 .BYTE $03              03
0522 .BYTE $05              05
0523 FWRTR2 
0523 .BYTE $02              02
0524 .BYTE $05              05
0525 .BYTE $08              08
0526 .BYTE $04              04
0527 .BYTE $01              01
0528 .BYTE $00              00
0529 .BYTE $09              09
052A .BYTE $07              07
052B .BYTE $06              06
052C .BYTE $03              03
052D FWRTR3 
052D .BYTE $04              04
052E .BYTE $03              03
052F .BYTE $05              05
0530 .BYTE $08              08
0531 .BYTE $01              01
0532 .BYTE $06              06
0533 .BYTE $02              02
0534 .BYTE $00              00
0535 .BYTE $07              07
0536 .BYTE $09              09
0537 REFLEC 
0537 .BYTE $02              02
0538 .BYTE $05              05
0539 .BYTE $00              00
053A .BYTE $07              07
053B .BYTE $09              09
053C .BYTE $01              01
053D .BYTE $08              08
053E .BYTE $03              03
053F .BYTE $06              06
0540 .BYTE $04              04
0541 BWRTR1 
0541 .BYTE $07              07
0542 .BYTE $03              03
0543 .BYTE $05              05
0544 .BYTE $08              08
0545 .BYTE $02              02
0546 .BYTE $09              09
0547 .BYTE $01              01
0548 .BYTE $06              06
0549 .BYTE $04              04
054A .BYTE $00              00
054B BWRTR2 
054B .BYTE $05              05
054C .BYTE $04              04
054D .BYTE $00              00
054E .BYTE $09              09
054F .BYTE $03              03
0550 .BYTE $01              01
0551 .BYTE $08              08
0552 .BYTE $07              07
0553 .BYTE $02              02
0554 .BYTE $06              06
0555 BWRTR3 
0555 .BYTE $07              07
0556 .BYTE $04              04
0557 .BYTE $06              06
0558 .BYTE $01              01
0559 .BYTE $00              00
055A .BYTE $02              02
055B .BYTE $05              05
055C .BYTE $08              08
055D .BYTE $03              03
055E .BYTE $09              09

055F KEYTBL 
055F .BYTE $10              10
0560 INC_V1 
0560 .BYTE $0C              0C
0561 DEC_V1 
0561 .BYTE $11              11
0562 INC_V2 
0562 .BYTE $0D              0D
0563 DEC_V2 
0563 .BYTE $14              14
0564 INC_V3 
0564 .BYTE $0E              0E
0565 DEC_V3 
0565 .BYTE $12              12
0566 INC_V4 
0566 .BYTE $0F              0F
0567 DEC_V4 

0567 INIT   

0567        CLD             D8
0568        LDA #$00        A9 00
056A REM_RO 
056A        CMP *ENIGVA     C5 50
056C        BNE INITOK      D0 10

056E ZEROIZ 
056E        LDA #$12        A9 12
0570 REM_14 
0570        STA *TMP01      85 5E
0572        LDX #$00        A2 00

0574 CPYINI 
0574        LDA GEARTX,X    BD 03 05
0577        STA *ROLLTB,X   95 4B
0579        INX             E8
057A        DEC *TMP01      C6 5E
057C        BNE CPYINI      D0 F6

057E INITOK 

057E START  

057E        JSR TIMEOU      20 B1 05

0581 MNURET 

0581        JSR SHOWEN      20 C0 05

0584        CMP #$15        C9 15
0586        BCS START       B0 F6
0588 REM_IF 

0588        CMP #$0A        C9 0A
058A        BCC SKIPMR      90 10
058C REM_IF 
058C        BEQ KPUSHA      F0 1A

058E        CMP #$0B        C9 0B
0590        BEQ KPUSHB      F0 19

0592        CMP #$13        C9 13
0594        BEQ KPUSHG      F0 18

0596        JSR MOVROT      20 E1 05
0599        JMP START       4C 7E 05

059C SKIPMR 
059C        STA *KEYIN      85 5B
059E        JSR STEPRT      20 22 06
05A1 REM_FA 

05A1        LDA #$50        A9 50
05A3        STA *TIMEO1     85 5D

05A5        JMP START       4C 7E 05

05A8 KPUSHA 
05A8        JMP START       4C 7E 05
05AB KPUSHB 
05AB        JMP SETUP       4C FE 06
05AE KPUSHG 
05AE        JMP ZEROIZ      4C 6E 05


05B1 REM_SU 
05B1 TIMEOU 

05B1        LDA #$00        A9 00
05B3        CMP *TIMEO1     C5 5D
05B5        BEQ TIMEOS      F0 08
05B7        DEC *TIMEO1     C6 5D
05B9        BNE TIMEOS      D0 04

05BB TIMEOC 
05BB        STA *KEYIN      85 5B
05BD        STA *KEYOUT     85 5C

05BF TIMEOS 
05BF        RTS             60


05C0 REM_SU 
05C0 SHOWEN 

05C0        LDX #$00        A2 00
05C2        LDY #$03        A0 03
05C4 SHOWND 
05C4        LDA *ROTORS,X   B5 57
05C6        ASL A           0A
05C7        ASL A           0A
05C8        ASL A           0A
05C9        ASL A           0A
05CA        STA $00F8,Y     99 F8 00
05CD        INX             E8
05CE        LDA *ROTORS,X   B5 57
05D0        ORA $00F8,Y     19 F8 00
05D3        STA $00F8,Y     99 F8 00
05D6        INX             E8
05D7        DEY             88
05D8        BNE SHOWND      D0 EA

05DA        JSR SCANS       20 1F 1F
05DD        JMP GETKEY      4C 6A 1F

05E0        NOP             EA


05E1 REM_SU 
05E1 MOVROT 

05E1        LDX *$00        A6 00
05E3        LDY *$04        A4 04
05E5        STX *TMP01      86 5E

05E7 MOVRSC 
05E7        CMP KEYTBL,X    DD 5F 05
05EA        BEQ MOVRIN      F0 0D
05EC        CMP INC_V1,X    DD 60 05
05EF        BEQ MOVRDE      F0 0F
05F1        INC *TMP01      E6 5E
05F3        INX             E8
05F4        INX             E8
05F5        DEY             88
05F6        BNE MOVRSC      D0 EF
05F8        RTS             60

05F9 MOVRIN 
05F9        LDX *TMP01      A6 5E
05FB        INC *ROTORS,X   F6 57
05FD        JMP MOVRCK      4C 04 06

0600 MOVRDE 
0600        LDX *TMP01      A6 5E
0602        DEC *ROTORS,X   D6 57

0604 MOVRCK 
0604        LDA #$00        A9 00
0606        JSR TIMEOC      20 BB 05


0609 REM_CO 

0609 AND_RE 


0609 REM_SU 

0609 REM_CA 

0609 REM_TO 

0609 REM_AF 

0609 ROLLOV 

0609        LDY #$02        A0 02
060B        STY *TMP02      84 5F
060D        LDY *ROLLTB     A4 4B

060F ROLLNX 

060F        LDA *ROTORS,X   B5 57
0611        CMP ROLLDF,Y    D9 C2 06
0614        BNE ROLL09      D0 03
0616        LDA ROLLSV,Y    B9 C3 06
0619 ROLL09 
0619        INY             C8
061A        INY             C8
061B        STA *ROTORS,X   95 57

061D        DEC *TMP02      C6 5F
061F        BNE ROLLNX      D0 EE

0621        RTS             60


0622 REM_SU 
0622 STEPRT 

0622        LDY #$01        A0 01
0624        STY *TMP01      84 5E

0626        LDX #$03        A2 03

0628 STEPDO 
0628        LDA #$00        A9 00
062A        LDA *ROTORS,X   B5 57
062C        NOP             EA

062D        PHA             48
062E        CMP #$09        C9 09
0630        BNE STEPSK      D0 10

0632        LDA *ENIGV1     A5 4F
0634        CMP #$00        C9 00
0636        BNE STEPGR      D0 06

0638        CPX #$00        E0 00
063A        BEQ STEPSK      F0 06

063C        STY *TMP01      84 5E

063E STEPGR 

063E        INC *TMP01      E6 5E
0640        INC *TMP01      E6 5E

0642 STEPSK 
0642        CLC             18
0643        ROR *TMP01      66 5E
0645        BCC STEPNI      90 07

0647        INC *ROTORS,X   F6 57
0649        JSR ROLLOV      20 09 06
064C        LDY #$01        A0 01
064E REM_RO 

064E STEPNI 

064E        PLA             68
064F        CMP #$09        C9 09
0651        BEQ STEPCN      F0 06

0653        LDA *ENIGV1     A5 4F
0655        CMP #$00        C9 00
0657        BNE STEPEX      D0 05

0659 STEPCN 

0659        DEX             CA
065A        CPX #$FF        E0 FF
065C        BNE STEPDO      D0 CA

065E STEPEX 


065E REM_FA 


065E REM_SU 
065E ENIGMA 

065E        LDX #$00        A2 00
0660        STX *TMP04      86 61
0662        DEX             CA
0663        STX *TMP03      86 60

0665        LDY #$07        A0 07
0667        LDX #$03        A2 03
0669        LDA *KEYIN      A5 5B

066B ENIGM2 
066B        JSR ENRING      20 B0 06

066E        STX *TMP01      86 5E

0670        PHA             48
0671        TXA             8A
0672        CMP #$00        C9 00
0674        BEQ ENIGXO      F0 03

0676        LDA *ENIGV1,X   B5 4F
0678        TAX             AA

0679 ENIGXO 
0679        PLA             68

067A        CLC             18
067B        ADC *TMP04      65 61
067D        ADC ROTIDX,X    7D 15 05
0680        TAX             AA
0681        LDA FWRTR1,X    BD 19 05

0684        PHA             48
0685        LDA #$00        A9 00
0687        LDX *TMP01      A6 5E
0689        JSR ENRING      20 B0 06
068C        STA *TMP02      85 5F
068E        PLA             68

068F        SEC             38
0690        SBC *TMP02      E5 5F
0692        BCS ENIGM3      B0 02
0694        ADC #$0A        69 0A

0696 ENIGM3 

0696        STA *KEYOUT     85 5C

0698        TYA             98

0699        CMP #$04        C9 04
069B        BNE ENIGNB      D0 08


069D REM_SE 

069D        LDA #$01        A9 01
069F        STA *TMP03      85 60

06A1        LDA #$28        A9 28
06A3        STA *TMP04      85 61

06A5 ENIGNB 

06A5        TXA             8A
06A6        CLC             18
06A7        ADC *TMP03      65 60
06A9        TAX             AA

06AA        LDA *KEYOUT     A5 5C

06AC        DEY             88
06AD        BNE ENIGM2      D0 BC

06AF        RTS             60


06B0 REM_SU 

06B0 CALL_W 

06B0 CALL_W 
06B0 ENRING 

06B0        SEC             38
06B1        ADC *ROTORS,X   75 57
06B3 REM_PL 
06B3        CMP #$0A        C9 0A
06B5        BCC ENRIK1      90 02
06B7 REM_AB 
06B7        SBC #$0A        E9 0A
06B9 REM_CA 

06B9 ENRIK1 
06B9        SEC             38
06BA        SBC *RINGST,X   F5 53
06BC        BCS ENRIK2      B0 02
06BE        ADC #$0A        69 0A

06C0 ENRIK2 
06C0        CLC             18
06C1        RTS             60

06C2 ROLLDF 
06C2 REM_NO 
06C2 .BYTE $FF              FF
06C3 ROLLSV 
06C3 .BYTE $09              09
06C4 .BYTE $0A              0A
06C5 .BYTE $00              00


06C6 REM_ME 

06C6 ROLLRT 
06C6 REM_RO 
06C6 .BYTE $00              00
06C7 .BYTE $03              03
06C8 .BYTE $04              04
06C9 .BYTE $01              01
06CA ROLLGR 
06CA REM_GE 
06CA .BYTE $FF              FF
06CB .BYTE $01              01
06CC .BYTE $02              02
06CD .BYTE $00              00


06CE REM_SU 

06CE REM_A_ 

06CE REM_FR 

06CE REM_TO 
06CE COPY   
06CE        STA *TMP01      85 5E

06D0 COPYDO 
06D0        LDA *$00,X      B5 00
06D2        STA $0000,Y     99 00 00
06D5        INX             E8
06D6        INY             C8
06D7        DEC *TMP01      C6 5E
06D9        BNE COPYDO      D0 F5
06DB        RTS             60


06DC REM_SU 
06DC READKY 

06DC        LDX #$0F        A2 0F
06DE        STX *KEYIN      86 5B

06E0        JSR SHOWEN      20 C0 05

06E3        CMP #$15        C9 15
06E5        BCS READKY      B0 F5
06E7 REM_IF 

06E7        CMP #$13        C9 13
06E9 REM_GO 
06E9        BNE READKG      D0 07
06EB        TSX             BA
06EC REM_BA 
06EC        INX             E8
06ED        INX             E8
06EE REM_DI 
06EE        TXS             9A
06EF REM_AN 
06EF        JMP ZEROIZ      4C 6E 05
06F2 REM_SE 
06F2 READKG 

06F2        CMP #$0B        C9 0B
06F4        BEQ READEX      F0 07
06F6 REM_IF 
06F6        BCC READKY      90 E4
06F8 REM_IF 

06F8 REM_IF 
06F8        PHA             48
06F9 REM_SA 
06F9        JSR MOVROT      20 E1 05
06FC CHANGE 
06FC        PLA             68
06FD REM_AF 
06FD READEX 

06FD        RTS             60


06FE REM_SU 
06FE SETUP  
06FE        LDA #$04        A9 04
0700        STA *ROLLTB     85 4B
0702        LDX #ROTORS     A2 57
0704        LDY #TMP06      A0 63
0706        JSR COPY        20 CE 06

0709        LDA #$03        A9 03
070B        LDX #ENIGVA     A2 50
070D        LDY #LROTOR     A0 58
070F        JSR COPY        20 CE 06

0712 SETF1  

0712        LDX #$00        A2 00
0714        STX *ROTORS     86 57
0716        STX *TMP03      86 60
0718        STX *TMP04      86 61
071A        STX *TMP05      86 62
071C        INX             E8
071D        STX *KEYOUT     86 5C

071F        LDX #$04        A2 04

0721 SETF1E 

0721        JSR READKY      20 DC 06

0724        CMP #$0B        C9 0B
0726        BEQ SETCHK      F0 03

0728        JMP SETF1       4C 12 07

072B SETCHK 

072B        LDA #$01        A9 01
072D        LDX *LROTOR     A6 58
072F        STA *TMP02,X    95 5F
0731        LDX *MROTOR     A6 59
0733        STA *TMP02,X    95 5F
0735        LDX *RROTOR     A6 5A
0737        STA *TMP02,X    95 5F
0739        LDA #$00        A9 00
073B        CLC             18
073C        ADC *TMP03      65 60
073E        ADC *TMP04      65 61
0740        ADC *TMP05      65 62

0742        CMP #$03        C9 03
0744        BEQ SETUOK      F0 08

0746        LDA #$0E        A9 0E
0748        JSR TIMEOC      20 BB 05
074B        JMP SETF1E      4C 21 07

074E SETUOK 

074E        LDA #$00        A9 00
0750        STA *ROLLTB     85 4B

0752        LDX #LROTOR     A2 58
0754        LDY #ENIGVA     A0 50
0756        JSR COPY        20 CE 06

0759        LDA #$04        A9 04
075B        LDX #RINGST     A2 53
075D        LDY #ROTORS     A0 57
075F        JSR COPY        20 CE 06

0762 SETF2  

0762        LDX #$02        A2 02
0764        STX *KEYOUT     86 5C

0766        JSR READKY      20 DC 06

0769        CMP #$0B        C9 0B
076B        BEQ RNGCHK      F0 03

076D        JMP SETF2       4C 62 07

0770 RNGCHK 

0770        LDA #$08        A9 08
0772        STA *ROLLTB     85 4B

0774        LDA #$04        A9 04
0776        LDX #ROTORS     A2 57
0778        LDY #RINGST     A0 53
077A        JSR COPY        20 CE 06

077D SETF3  

077D        LDA #$04        A9 04
077F        LDX #GEARAM     A2 4C
0781        LDY #ROTORS     A0 57
0783        JSR COPY        20 CE 06

0786        LDX #$03        A2 03
0788        STX *KEYOUT     86 5C

078A        JSR READKY      20 DC 06

078D        CMP #$0B        C9 0B
078F        BEQ GEACHK      F0 03

0791        JMP SETF3       4C 7D 07

0794 GEACHK 

0794        LDA #$04        A9 04
0796        LDX #TMP06      A2 63
0798        LDY #ROTORS     A0 57
079A        JSR COPY        20 CE 06

079D        LDA #$00        A9 00
079F        STA *ROLLTB     85 4B
07A1 REM_SE 
07A1        JSR TIMEOC      20 BB 05

07A4        JMP MNURET      4C 81 05

done.
