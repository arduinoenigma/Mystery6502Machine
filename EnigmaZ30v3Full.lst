pass 2

0000 TODO:  


0000 REM_TO 

0000 REM_IS 

* = $0500
0500 ROLLTB = 004B
0500 GEARAM = 004C
0500 GEAR_W 
0500 ENIGV1 = 004F
0500 ONE_LE 
0500 ENIGVA = 0050
0500 RINGST = 0053
0500 REM_RO 
0500 ROTORS = 0057
0500 REM_RE 
0500 LROTOR = 0058
0500 MROTOR = 0059
0500 RROTOR = 005A
0500 KEYIN  = 005B
0500 KEYOUT = 005C

0500 TIMEO1 = 005D
0500 TMP01  = 005E
0500 TMP02  = 005F
0500 TMP03  = 0060
0500 TMP04  = 0061
0500 TMP05  = 0062
0500 TMP06  = 0063

0500 DISP3  = 00F9

0500 GETKEY = 1F6A
0500 SCANS  = 1F1F

0500        JMP INIT        4C 67 05

0503 GEARTX 
0503 .BYTE $00              00
0504 .BYTE $06              06
0505 .BYTE $0E              0E
0506 .BYTE $0A              0A

0507 DEFVAL 
0507 .BYTE $00              00
0508 .BYTE $01              01
0509 .BYTE $02              02
050A .BYTE $03              03
050B .BYTE $01              01
050C .BYTE $01              01
050D .BYTE $01              01
050E .BYTE $01              01
050F .BYTE $04              04
0510 .BYTE $03              03
0511 .BYTE $02              02
0512 .BYTE $01              01
0513 .BYTE $00              00
0514 .BYTE $00              00

0515 ROTIDX 
0515 .BYTE $1E              1E
0516 .BYTE $00              00
0517 .BYTE $0A              0A
0518 .BYTE $14              14

0519 FWRTR1 
0519 .BYTE $09              09
051A .BYTE $06              06
051B .BYTE $04              04
051C .BYTE $01              01
051D .BYTE $08              08
051E .BYTE $02              02
051F .BYTE $07              07
0520 .BYTE $00              00
0521 .BYTE $03              03
0522 .BYTE $05              05
0523 FWRTR2 
0523 .BYTE $02              02
0524 .BYTE $05              05
0525 .BYTE $08              08
0526 .BYTE $04              04
0527 .BYTE $01              01
0528 .BYTE $00              00
0529 .BYTE $09              09
052A .BYTE $07              07
052B .BYTE $06              06
052C .BYTE $03              03
052D FWRTR3 
052D .BYTE $04              04
052E .BYTE $03              03
052F .BYTE $05              05
0530 .BYTE $08              08
0531 .BYTE $01              01
0532 .BYTE $06              06
0533 .BYTE $02              02
0534 .BYTE $00              00
0535 .BYTE $07              07
0536 .BYTE $09              09
0537 REFLEC 
0537 .BYTE $02              02
0538 .BYTE $05              05
0539 .BYTE $00              00
053A .BYTE $07              07
053B .BYTE $09              09
053C .BYTE $01              01
053D .BYTE $08              08
053E .BYTE $03              03
053F .BYTE $06              06
0540 .BYTE $04              04
0541 BWRTR1 
0541 .BYTE $07              07
0542 .BYTE $03              03
0543 .BYTE $05              05
0544 .BYTE $08              08
0545 .BYTE $02              02
0546 .BYTE $09              09
0547 .BYTE $01              01
0548 .BYTE $06              06
0549 .BYTE $04              04
054A .BYTE $00              00
054B BWRTR2 
054B .BYTE $05              05
054C .BYTE $04              04
054D .BYTE $00              00
054E .BYTE $09              09
054F .BYTE $03              03
0550 .BYTE $01              01
0551 .BYTE $08              08
0552 .BYTE $07              07
0553 .BYTE $02              02
0554 .BYTE $06              06
0555 BWRTR3 
0555 .BYTE $07              07
0556 .BYTE $04              04
0557 .BYTE $06              06
0558 .BYTE $01              01
0559 .BYTE $00              00
055A .BYTE $02              02
055B .BYTE $05              05
055C .BYTE $08              08
055D .BYTE $03              03
055E .BYTE $09              09

055F KEYTBL 
055F .BYTE $10              10
0560 INC_V1 
0560 .BYTE $0C              0C
0561 DEC_V1 
0561 .BYTE $11              11
0562 INC_V2 
0562 .BYTE $0D              0D
0563 DEC_V2 
0563 .BYTE $14              14
0564 INC_V3 
0564 .BYTE $0E              0E
0565 DEC_V3 
0565 .BYTE $12              12
0566 INC_V4 
0566 .BYTE $0F              0F
0567 DEC_V4 

0567 INIT   

0567        CLD             D8
0568        LDA #$00        A9 00
056A REM_RO 
056A        CMP *ENIGVA     C5 50
056C        BNE INITOK      D0 10

056E ZEROIZ 
056E        LDA #$12        A9 12
0570 REM_14 
0570        STA *TMP01      85 5E
0572        LDX #$00        A2 00

0574 CPYINI 
0574        LDA GEARTX,X    BD 03 05
0577        STA *ROLLTB,X   95 4B
0579        INX             E8
057A        DEC *TMP01      C6 5E
057C        BNE CPYINI      D0 F6

057E INITOK 

057E START  

057E        JSR TIMEOU      20 B1 05

0581 MNURET 

0581        JSR SHOWEN      20 C0 05

0584        CMP #$15        C9 15
0586        BCS START       B0 F6
0588 REM_IF 

0588        CMP #$0A        C9 0A
058A        BCC SKIPMR      90 10
058C REM_IF 
058C        BEQ KPUSHA      F0 1A

058E        CMP #$0B        C9 0B
0590        BEQ KPUSHB      F0 19

0592        CMP #$13        C9 13
0594        BEQ KPUSHG      F0 18

0596        JSR MOVROT      20 E0 05
0599        JMP START       4C 7E 05

059C SKIPMR 
059C        STA *KEYIN      85 5B
059E        JSR STEPRT      20 21 06
05A1 REM_FA 

05A1        LDA #$50        A9 50
05A3        STA *TIMEO1     85 5D

05A5        JMP START       4C 7E 05

05A8 KPUSHA 
05A8        JMP START       4C 7E 05
05AB KPUSHB 
05AB        JMP SETUP       4C FD 06
05AE KPUSHG 
05AE        JMP ZEROIZ      4C 6E 05


05B1 REM_SU 
05B1 TIMEOU 

05B1        LDA #$00        A9 00
05B3        CMP *TIMEO1     C5 5D
05B5        BEQ TIMEOS      F0 08
05B7        DEC *TIMEO1     C6 5D
05B9        BNE TIMEOS      D0 04

05BB TIMEOC 
05BB        STA *KEYIN      85 5B
05BD        STA *KEYOUT     85 5C

05BF TIMEOS 
05BF        RTS             60


05C0 REM_SU 
05C0 SHOWEN 

05C0        LDX #$00        A2 00
05C2        LDY #$03        A0 03
05C4 SHOWND 
05C4        LDA *ROTORS,X   B5 57
05C6        ASL A           0A
05C7        ASL A           0A
05C8        ASL A           0A
05C9        ASL A           0A
05CA        STA $00F8,Y     99 F8 00
05CD        INX             E8
05CE        LDA *ROTORS,X   B5 57
05D0        ORA $00F8,Y     19 F8 00
05D3        STA $00F8,Y     99 F8 00
05D6        INX             E8
05D7        DEY             88
05D8        BNE SHOWND      D0 EA

05DA        JSR SCANS       20 1F 1F
05DD        JMP GETKEY      4C 6A 1F


05E0 REM_SU 
05E0 MOVROT 

05E0        LDX *$00        A6 00
05E2        LDY *$04        A4 04
05E4        STX *TMP01      86 5E

05E6 MOVRSC 
05E6        CMP KEYTBL,X    DD 5F 05
05E9        BEQ MOVRIN      F0 0D
05EB        CMP INC_V1,X    DD 60 05
05EE        BEQ MOVRDE      F0 0F
05F0        INC *TMP01      E6 5E
05F2        INX             E8
05F3        INX             E8
05F4        DEY             88
05F5        BNE MOVRSC      D0 EF
05F7        RTS             60

05F8 MOVRIN 
05F8        LDX *TMP01      A6 5E
05FA        INC *ROTORS,X   F6 57
05FC        JMP MOVRCK      4C 03 06

05FF MOVRDE 
05FF        LDX *TMP01      A6 5E
0601        DEC *ROTORS,X   D6 57

0603 MOVRCK 
0603        LDA #$00        A9 00
0605        JSR TIMEOC      20 BB 05


0608 REM_CO 

0608 AND_RE 


0608 REM_SU 

0608 REM_CA 

0608 REM_TO 

0608 REM_AF 

0608 ROLLOV 

0608        LDY #$02        A0 02
060A        STY *TMP02      84 5F
060C        LDY *ROLLTB     A4 4B

060E ROLLNX 

060E        LDA *ROTORS,X   B5 57
0610        CMP ROLLDF,Y    D9 C1 06
0613        BNE ROLL09      D0 03
0615        LDA ROLLSV,Y    B9 C2 06
0618 ROLL09 
0618        INY             C8
0619        INY             C8
061A        STA *ROTORS,X   95 57

061C        DEC *TMP02      C6 5F
061E        BNE ROLLNX      D0 EE

0620        RTS             60


0621 REM_SU 
0621 STEPRT 

0621        LDY #$01        A0 01
0623        STY *TMP01      84 5E

0625        LDX #$03        A2 03

0627 STEPDO 
0627        LDA #$00        A9 00
0629        LDA *ROTORS,X   B5 57
062B        NOP             EA

062C        PHA             48
062D        CMP #$09        C9 09
062F        BNE STEPSK      D0 10

0631        LDA *ENIGV1     A5 4F
0633        CMP #$00        C9 00
0635        BNE STEPGR      D0 06

0637        CPX #$00        E0 00
0639        BEQ STEPSK      F0 06

063B        STY *TMP01      84 5E

063D STEPGR 

063D        INC *TMP01      E6 5E
063F        INC *TMP01      E6 5E

0641 STEPSK 
0641        CLC             18
0642        ROR *TMP01      66 5E
0644        BCC STEPNI      90 07

0646        INC *ROTORS,X   F6 57
0648        JSR ROLLOV      20 08 06
064B        LDY #$01        A0 01
064D REM_RO 

064D STEPNI 

064D        PLA             68
064E        CMP #$09        C9 09
0650        BEQ STEPCN      F0 06

0652        LDA *ENIGV1     A5 4F
0654        CMP #$00        C9 00
0656        BNE STEPEX      D0 05

0658 STEPCN 

0658        DEX             CA
0659        CPX #$FF        E0 FF
065B        BNE STEPDO      D0 CA

065D STEPEX 


065D REM_FA 


065D REM_SU 
065D ENIGMA 

065D        LDX #$00        A2 00
065F        STX *TMP04      86 61
0661        DEX             CA
0662        STX *TMP03      86 60

0664        LDY #$07        A0 07
0666        LDX #$03        A2 03
0668        LDA *KEYIN      A5 5B

066A ENIGM2 
066A        JSR ENRING      20 AF 06

066D        STX *TMP01      86 5E

066F        PHA             48
0670        TXA             8A
0671        CMP #$00        C9 00
0673        BEQ ENIGXO      F0 03

0675        LDA *ENIGV1,X   B5 4F
0677        TAX             AA

0678 ENIGXO 
0678        PLA             68

0679        CLC             18
067A        ADC *TMP04      65 61
067C        ADC ROTIDX,X    7D 15 05
067F        TAX             AA
0680        LDA FWRTR1,X    BD 19 05

0683        PHA             48
0684        LDA #$00        A9 00
0686        LDX *TMP01      A6 5E
0688        JSR ENRING      20 AF 06
068B        STA *TMP02      85 5F
068D        PLA             68

068E        SEC             38
068F        SBC *TMP02      E5 5F
0691        BCS ENIGM3      B0 02
0693        ADC #$0A        69 0A

0695 ENIGM3 

0695        STA *KEYOUT     85 5C

0697        TYA             98

0698        CMP #$04        C9 04
069A        BNE ENIGNB      D0 08


069C REM_SE 

069C        LDA #$01        A9 01
069E        STA *TMP03      85 60

06A0        LDA #$28        A9 28
06A2        STA *TMP04      85 61

06A4 ENIGNB 

06A4        TXA             8A
06A5        CLC             18
06A6        ADC *TMP03      65 60
06A8        TAX             AA

06A9        LDA *KEYOUT     A5 5C

06AB        DEY             88
06AC        BNE ENIGM2      D0 BC

06AE        RTS             60


06AF REM_SU 

06AF CALL_W 

06AF CALL_W 
06AF ENRING 

06AF        SEC             38
06B0        ADC *ROTORS,X   75 57
06B2 REM_PL 
06B2        CMP #$0A        C9 0A
06B4        BCC ENRIK1      90 02
06B6 REM_AB 
06B6        SBC #$0A        E9 0A
06B8 REM_CA 

06B8 ENRIK1 
06B8        SEC             38
06B9        SBC *RINGST,X   F5 53
06BB        BCS ENRIK2      B0 02
06BD        ADC #$0A        69 0A

06BF ENRIK2 
06BF        CLC             18
06C0        RTS             60

06C1 ROLLDF 
06C1 REM_NO 
06C1 .BYTE $FF              FF
06C2 ROLLSV 
06C2 .BYTE $09              09
06C3 .BYTE $0A              0A
06C4 .BYTE $00              00


06C5 REM_ME 

06C5 ROLLRT 
06C5 REM_RO 
06C5 .BYTE $00              00
06C6 .BYTE $03              03
06C7 .BYTE $04              04
06C8 .BYTE $01              01
06C9 ROLLGR 
06C9 REM_GE 
06C9 .BYTE $FF              FF
06CA .BYTE $01              01
06CB .BYTE $02              02
06CC .BYTE $00              00


06CD REM_SU 

06CD REM_A_ 

06CD REM_FR 

06CD REM_TO 
06CD COPY   
06CD        STA *TMP01      85 5E

06CF COPYDO 
06CF        LDA *$00,X      B5 00
06D1        STA $0000,Y     99 00 00
06D4        INX             E8
06D5        INY             C8
06D6        DEC *TMP01      C6 5E
06D8        BNE COPYDO      D0 F5
06DA        RTS             60


06DB REM_SU 
06DB READKY 

06DB        LDX #$0F        A2 0F
06DD        STX *KEYIN      86 5B

06DF        JSR SHOWEN      20 C0 05

06E2        CMP #$15        C9 15
06E4        BCS READKY      B0 F5
06E6 REM_IF 

06E6        CMP #$13        C9 13
06E8 REM_GO 
06E8        BNE READKG      D0 07
06EA        TSX             BA
06EB REM_BA 
06EB        INX             E8
06EC        INX             E8
06ED REM_DI 
06ED        TXS             9A
06EE REM_AN 
06EE        JMP ZEROIZ      4C 6E 05
06F1 REM_SE 
06F1 READKG 

06F1        CMP #$0B        C9 0B
06F3        BEQ READEX      F0 07
06F5 REM_IF 
06F5        BCC READKY      90 E4
06F7 REM_IF 

06F7 REM_IF 
06F7        PHA             48
06F8 REM_SA 
06F8        JSR MOVROT      20 E0 05
06FB CHANGE 
06FB        PLA             68
06FC REM_AF 
06FC READEX 

06FC        RTS             60


06FD REM_SU 
06FD SETUP  
06FD        LDA #$04        A9 04
06FF        STA *ROLLTB     85 4B
0701        LDX #ROTORS     A2 57
0703        LDY #TMP06      A0 63
0705        JSR COPY        20 CD 06

0708        LDA #$03        A9 03
070A        LDX #ENIGVA     A2 50
070C        LDY #LROTOR     A0 58
070E        JSR COPY        20 CD 06

0711 SETF1  

0711        LDX #$00        A2 00
0713        STX *ROTORS     86 57
0715        STX *TMP03      86 60
0717        STX *TMP04      86 61
0719        STX *TMP05      86 62
071B        INX             E8
071C        STX *KEYOUT     86 5C

071E        LDX #$04        A2 04

0720 SETF1E 

0720        JSR READKY      20 DB 06

0723        CMP #$0B        C9 0B
0725        BEQ SETCHK      F0 03

0727        JMP SETF1       4C 11 07

072A SETCHK 

072A        LDA #$01        A9 01
072C        LDX *LROTOR     A6 58
072E        STA *TMP02,X    95 5F
0730        LDX *MROTOR     A6 59
0732        STA *TMP02,X    95 5F
0734        LDX *RROTOR     A6 5A
0736        STA *TMP02,X    95 5F
0738        LDA #$00        A9 00
073A        CLC             18
073B        ADC *TMP03      65 60
073D        ADC *TMP04      65 61
073F        ADC *TMP05      65 62

0741        CMP #$03        C9 03
0743        BEQ SETUOK      F0 08

0745        LDA #$0E        A9 0E
0747        JSR TIMEOC      20 BB 05
074A        JMP SETF1E      4C 20 07

074D SETUOK 

074D        LDA #$00        A9 00
074F        STA *ROLLTB     85 4B

0751        LDX #LROTOR     A2 58
0753        LDY #ENIGVA     A0 50
0755        JSR COPY        20 CD 06

0758        LDA #$04        A9 04
075A        LDX #RINGST     A2 53
075C        LDY #ROTORS     A0 57
075E        JSR COPY        20 CD 06

0761 SETF2  

0761        LDX #$02        A2 02
0763        STX *KEYOUT     86 5C

0765        JSR READKY      20 DB 06

0768        CMP #$0B        C9 0B
076A        BEQ RNGCHK      F0 03

076C        JMP SETF2       4C 61 07

076F RNGCHK 

076F        LDA #$08        A9 08
0771        STA *ROLLTB     85 4B

0773        LDA #$04        A9 04
0775        LDX #ROTORS     A2 57
0777        LDY #RINGST     A0 53
0779        JSR COPY        20 CD 06

077C SETF3  

077C        LDA #$04        A9 04
077E        LDX #GEARAM     A2 4C
0780        LDY #ROTORS     A0 57
0782        JSR COPY        20 CD 06

0785        LDX #$03        A2 03
0787        STX *KEYOUT     86 5C

0789        JSR READKY      20 DB 06

078C        CMP #$0B        C9 0B
078E        BEQ GEACHK      F0 03

0790        JMP SETF3       4C 7C 07

0793 GEACHK 

0793        LDA #$04        A9 04
0795        LDX #TMP06      A2 63
0797        LDY #ROTORS     A0 57
0799        JSR COPY        20 CD 06

079C        LDA #$00        A9 00
079E        STA *ROLLTB     85 4B
07A0 REM_SE 
07A0        JSR TIMEOC      20 BB 05

07A3        JMP MNURET      4C 81 05

done.
