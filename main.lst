pass 2

0000 TODO:  


0000 REM_TO 

0000 REM_IS 

* = $0500
0500 ENIGV1 = 004F
0500 ONE_LE 
0500 ENIGVA = 0050
0500 RINGST = 0053
0500 REM_RO 
0500 LRRING = 0054
0500 ROTORS = 0057
0500 REM_RE 
0500 LROTOR = 0058
0500 KEYIN  = 005B
0500 KEYOUT = 005C

0500 TIMEO1 = 005D
0500 TMP01  = 005E
0500 TMP02  = 005F
0500 TMP03  = 0060
0500 TMP04  = 0061
0500 TMP05  = 0062
0500 TMP06  = 0063

0500 DISP3  = 00F9

0500 GETKEY = 1F6A
0500 SCANS  = 1F1F

0500        JMP INIT        4C 60 05

0503 DEFVAL 
0503 .BYTE $01              01
0504 .BYTE $02              02
0505 .BYTE $03              03
0506 .BYTE $01              01
0507 .BYTE $01              01
0508 .BYTE $01              01
0509 .BYTE $01              01
050A .BYTE $04              04
050B .BYTE $03              03
050C .BYTE $02              02
050D .BYTE $01              01

050E ROTIDX 
050E .BYTE $1E              1E
050F .BYTE $00              00
0510 .BYTE $0A              0A
0511 .BYTE $14              14

0512 FWRTR1 
0512 .BYTE $09              09
0513 .BYTE $06              06
0514 .BYTE $04              04
0515 .BYTE $01              01
0516 .BYTE $08              08
0517 .BYTE $02              02
0518 .BYTE $07              07
0519 .BYTE $00              00
051A .BYTE $03              03
051B .BYTE $05              05
051C FWRTR2 
051C .BYTE $02              02
051D .BYTE $05              05
051E .BYTE $08              08
051F .BYTE $04              04
0520 .BYTE $01              01
0521 .BYTE $00              00
0522 .BYTE $09              09
0523 .BYTE $07              07
0524 .BYTE $06              06
0525 .BYTE $03              03
0526 FWRTR3 
0526 .BYTE $04              04
0527 .BYTE $03              03
0528 .BYTE $05              05
0529 .BYTE $08              08
052A .BYTE $01              01
052B .BYTE $06              06
052C .BYTE $02              02
052D .BYTE $00              00
052E .BYTE $07              07
052F .BYTE $09              09
0530 REFLEC 
0530 .BYTE $02              02
0531 .BYTE $05              05
0532 .BYTE $00              00
0533 .BYTE $07              07
0534 .BYTE $09              09
0535 .BYTE $01              01
0536 .BYTE $08              08
0537 .BYTE $03              03
0538 .BYTE $06              06
0539 .BYTE $04              04
053A BWRTR1 
053A .BYTE $07              07
053B .BYTE $03              03
053C .BYTE $05              05
053D .BYTE $08              08
053E .BYTE $02              02
053F .BYTE $09              09
0540 .BYTE $01              01
0541 .BYTE $06              06
0542 .BYTE $04              04
0543 .BYTE $00              00
0544 BWRTR2 
0544 .BYTE $05              05
0545 .BYTE $04              04
0546 .BYTE $00              00
0547 .BYTE $09              09
0548 .BYTE $03              03
0549 .BYTE $01              01
054A .BYTE $08              08
054B .BYTE $07              07
054C .BYTE $02              02
054D .BYTE $06              06
054E BWRTR3 
054E .BYTE $07              07
054F .BYTE $04              04
0550 .BYTE $06              06
0551 .BYTE $01              01
0552 .BYTE $00              00
0553 .BYTE $02              02
0554 .BYTE $05              05
0555 .BYTE $08              08
0556 .BYTE $03              03
0557 .BYTE $09              09

0558 KEYTBL 
0558 .BYTE $10              10
0559 INC_V1 
0559 .BYTE $0C              0C
055A DEV_V1 
055A .BYTE $11              11
055B INC_V2 
055B .BYTE $0D              0D
055C DEV_V2 
055C .BYTE $14              14
055D INC_V3 
055D .BYTE $0E              0E
055E DEV_V3 
055E .BYTE $12              12
055F INC_V4 
055F .BYTE $0F              0F
0560 DEV_V4 

0560 INIT   

0560        CLD             D8
0561        LDA #$00        A9 00
0563 REM_RO 
0563        CMP *ENIGVA     C5 50
0565        BNE INITOK      D0 10

0567        LDA #$0B        A9 0B
0569 REM_11 
0569        STA *TIMEO1     85 5D
056B        LDX #$00        A2 00

056D CPYINI 
056D        LDA DEFVAL,X    BD 03 05
0570        STA *ENIGVA,X   95 50
0572        INX             E8
0573        DEC *TIMEO1     C6 5D
0575        BNE CPYINI      D0 F6

0577 INITOK 

0577 START  

0577        JSR TIMEOU      20 B5 05

057A        JSR SHOWEN      20 C4 05

057D        JSR SCANS       20 1F 1F
0580        JSR GETKEY      20 6A 1F

0583        CMP #$15        C9 15
0585        BCS START       B0 F0
0587 REM_IF 

0587        CMP #$0A        C9 0A
0589        BCC SKIPMR      90 12
058B REM_IF 

058B        CMP #$0A        C9 0A
058D        BEQ KPUSHA      F0 1D

058F        CMP #$0B        C9 0B
0591        BEQ KPUSHB      F0 1C

0593        CMP #$13        C9 13
0595        BEQ KPUSHG      F0 1B

0597        JSR MOVROT      20 DF 05
059A        JMP START       4C 77 05

059D SKIPMR 
059D        STA *KEYIN      85 5B
059F        JSR STEPRT      20 23 06
05A2        JSR ENIGMA      20 79 06

05A5        LDA #$50        A9 50
05A7        STA *TIMEO1     85 5D

05A9        JMP START       4C 77 05

05AC KPUSHA 
05AC        JMP START       4C 77 05
05AF KPUSHB 
05AF        JMP START       4C 77 05
05B2 KPUSHG 
05B2        JMP START       4C 77 05


05B5 REM_SU 
05B5 TIMEOU 

05B5        LDA #$00        A9 00
05B7        CMP *TIMEO1     C5 5D
05B9        BEQ TIMEOS      F0 08
05BB        DEC *TIMEO1     C6 5D
05BD        BNE TIMEOS      D0 04

05BF        STA *KEYIN      85 5B
05C1        STA *KEYOUT     85 5C

05C3 TIMEOS 
05C3        RTS             60


05C4 REM_SU 
05C4 SHOWEN 

05C4        LDX #$00        A2 00
05C6        LDY #$03        A0 03
05C8 SHOWND 
05C8        LDA *ROTORS,X   B5 57
05CA        ASL A           0A
05CB        ASL A           0A
05CC        ASL A           0A
05CD        ASL A           0A
05CE        STA $00F8,Y     99 F8 00
05D1        INX             E8
05D2        LDA *ROTORS,X   B5 57
05D4        ORA $00F8,Y     19 F8 00
05D7        STA $00F8,Y     99 F8 00
05DA        INX             E8
05DB        DEY             88
05DC        BNE SHOWND      D0 EA

05DE        RTS             60


05DF REM_SU 
05DF MOVROT 

05DF        LDX *$00        A6 00
05E1        LDY *$04        A4 04
05E3        STX *TMP01      86 5E

05E5 MOVRSC 
05E5        CMP KEYTBL,X    DD 58 05
05E8        BEQ MOVRIN      F0 0D
05EA        CMP INC_V1,X    DD 59 05
05ED        BEQ MOVRDE      F0 0F
05EF        INC *TMP01      E6 5E
05F1        INX             E8
05F2        INX             E8
05F3        DEY             88
05F4        BNE MOVRSC      D0 EF
05F6        RTS             60

05F7 MOVRIN 
05F7        LDX *TMP01      A6 5E
05F9        INC *ROTORS,X   F6 57
05FB        JMP MOVRCK      4C 02 06

05FE MOVRDE 
05FE        LDX *TMP01      A6 5E
0600        DEC *ROTORS,X   D6 57

0602 REM_JM 

0602 MOVRCK 
0602        LDA #$00        A9 00
0604        STA *KEYIN      85 5B
0606        STA *KEYOUT     85 5C

0608        JSR ROLLOV      20 0C 06

060B        RTS             60


060C REM_SU 

060C REM_CA 

060C REM_TO 

060C REM_AF 
060C ROLLOV 

060C        LDA #$FF        A9 FF
060E        CMP *ROTORS,X   D5 57
0610        BEQ ROLLO9      F0 07

0612        LDA #$0A        A9 0A
0614        CMP *ROTORS,X   D5 57
0616        BEQ ROLLO0      F0 06

0618        RTS             60

0619 ROLLO9 
0619        LDA #$09        A9 09
061B        STA *ROTORS,X   95 57
061D        RTS             60

061E ROLLO0 
061E        LDA #$00        A9 00
0620        STA *ROTORS,X   95 57
0622        RTS             60


0623 REM_SU 
0623 STEPRT 
0623        LDX #$00        A2 00
0625        LDY #$03        A0 03

0627 STEPSC 
0627        LDA *LRRING,X   B5 54
0629        CLC             18
062A        ADC #$08        69 08
062C        CMP #$0A        C9 0A
062E        BCC STEPS1      90 02
0630        SBC #$0A        E9 0A
0632 STEPS1 
0632        CMP *LROTOR,X   D5 58
0634        BNE STEPS2      D0 05
0636        LDA #$01        A9 01
0638        JMP STEPDN      4C 3D 06
063B STEPS2 
063B        LDA #$00        A9 00
063D STEPDN 
063D        STA *TMP02,X    95 5F
063F        INX             E8
0640        DEY             88
0641        BNE STEPSC      D0 E4

0643        STY *TMP01      84 5E
0645        LDA #$04        A9 04
0647        STA *TMP05      85 62
0649 REM_IN 
0649        STA *TMP06      85 63
064B        LDX #$00        A2 00
064D        LDY #$00        A0 00

064F STEPIW 
064F        LDA *TMP01,X    B5 5E
0651        STY *TMP01,X    94 5E
0653        INX             E8
0654        CLC             18
0655        ADC *TMP01,X    75 5E
0657        CMP #$00        C9 00
0659        BEQ STEPS3      F0 07

065B        DEX             CA
065C        INC *ROTORS,X   F6 57
065E        JSR ROLLOV      20 0C 06
0661        INX             E8

0662 STEPS3 
0662        DEC *TMP06      C6 63
0664        BNE STEPIW      D0 E9

0666        RTS             60


0667 REM_SU 

0667 CALL_W 

0667 CALL_W 
0667 ENRING 

0667        SEC             38
0668        ADC *ROTORS,X   75 57
066A REM_PL 
066A        CMP #$0A        C9 0A
066C        BCC ENRIK1      90 02
066E REM_AB 
066E        SBC #$0A        E9 0A
0670 REM_CA 

0670 ENRIK1 
0670        SEC             38
0671        SBC *RINGST,X   F5 53
0673        BCS ENRIK2      B0 02
0675        ADC #$0A        69 0A

0677 ENRIK2 
0677        CLC             18
0678        RTS             60


0679 REM_SU 
0679 ENIGMA 

0679        LDA #$FF        A9 FF
067B        STA *TMP03      85 60

067D        LDA #$00        A9 00
067F        STA *TMP04      85 61

0681        LDY #$07        A0 07
0683        LDX #$03        A2 03
0685        LDA *KEYIN      A5 5B

0687 ENIGM2 
0687        JSR ENRING      20 67 06

068A        STX *TMP01      86 5E

068C        PHA             48
068D        TXA             8A
068E        CMP #$00        C9 00
0690        BEQ ENIGXO      F0 03

0692        LDA *ENIGV1,X   B5 4F
0694        TAX             AA

0695 ENIGXO 
0695        PLA             68

0696        CLC             18
0697        ADC *TMP04      65 61
0699        ADC ROTIDX,X    7D 0E 05
069C        TAX             AA
069D        LDA FWRTR1,X    BD 12 05

06A0        PHA             48
06A1        LDA #$00        A9 00
06A3        LDX *TMP01      A6 5E
06A5        JSR ENRING      20 67 06
06A8        STA *TMP02      85 5F
06AA        PLA             68

06AB        SEC             38
06AC        SBC *TMP02      E5 5F
06AE        BCS ENIGM3      B0 02
06B0        ADC #$0A        69 0A

06B2 ENIGM3 

06B2        STA *KEYOUT     85 5C

06B4        TYA             98

06B5        CMP #$04        C9 04
06B7        BNE ENIGNB      D0 08


06B9 REM_SE 

06B9        LDA #$01        A9 01
06BB        STA *TMP03      85 60

06BD        LDA #$28        A9 28
06BF        STA *TMP04      85 61

06C1 ENIGNB 

06C1        TXA             8A
06C2        CLC             18
06C3        ADC *TMP03      65 60
06C5        TAX             AA

06C6        LDA *KEYOUT     A5 5C

06C8        DEY             88
06C9        BNE ENIGM2      D0 BC

06CB        RTS             60

done.
