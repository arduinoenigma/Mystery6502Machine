pass 2

0000 TODO:  


0000 REM_TO 

0000 REM_IS 

* = $0500
0500 ENIGV1 = 004F
0500 ONE_LE 
0500 ENIGVA = 0050
0500 RINGST = 0053
0500 REM_RO 
0500 ROTORS = 0057
0500 REM_RE 
0500 LROTOR = 0058
0500 KEYIN  = 005B
0500 KEYOUT = 005C

0500 TIMEO1 = 005D
0500 TMP01  = 005E
0500 TMP02  = 005F
0500 TMP03  = 0060
0500 TMP04  = 0061
0500 TMP05  = 0062
0500 TMP06  = 0063

0500 DISP3  = 00F9

0500 GETKEY = 1F6A
0500 SCANS  = 1F1F

0500        JMP INIT        4C 66 05

0503 GEARTX 
0503 .BYTE $06              06
0504 .BYTE $0E              0E
0505 .BYTE $0A              0A

0506 DEFVAL 
0506 .BYTE $00              00
0507 .BYTE $01              01
0508 .BYTE $02              02
0509 .BYTE $03              03
050A .BYTE $01              01
050B .BYTE $01              01
050C .BYTE $01              01
050D .BYTE $01              01
050E .BYTE $04              04
050F .BYTE $03              03
0510 .BYTE $02              02
0511 .BYTE $01              01
0512 .BYTE $00              00
0513 .BYTE $00              00

0514 ROTIDX 
0514 .BYTE $1E              1E
0515 .BYTE $00              00
0516 .BYTE $0A              0A
0517 .BYTE $14              14

0518 FWRTR1 
0518 .BYTE $09              09
0519 .BYTE $06              06
051A .BYTE $04              04
051B .BYTE $01              01
051C .BYTE $08              08
051D .BYTE $02              02
051E .BYTE $07              07
051F .BYTE $00              00
0520 .BYTE $03              03
0521 .BYTE $05              05
0522 FWRTR2 
0522 .BYTE $02              02
0523 .BYTE $05              05
0524 .BYTE $08              08
0525 .BYTE $04              04
0526 .BYTE $01              01
0527 .BYTE $00              00
0528 .BYTE $09              09
0529 .BYTE $07              07
052A .BYTE $06              06
052B .BYTE $03              03
052C FWRTR3 
052C .BYTE $04              04
052D .BYTE $03              03
052E .BYTE $05              05
052F .BYTE $08              08
0530 .BYTE $01              01
0531 .BYTE $06              06
0532 .BYTE $02              02
0533 .BYTE $00              00
0534 .BYTE $07              07
0535 .BYTE $09              09
0536 REFLEC 
0536 .BYTE $02              02
0537 .BYTE $05              05
0538 .BYTE $00              00
0539 .BYTE $07              07
053A .BYTE $09              09
053B .BYTE $01              01
053C .BYTE $08              08
053D .BYTE $03              03
053E .BYTE $06              06
053F .BYTE $04              04
0540 BWRTR1 
0540 .BYTE $07              07
0541 .BYTE $03              03
0542 .BYTE $05              05
0543 .BYTE $08              08
0544 .BYTE $02              02
0545 .BYTE $09              09
0546 .BYTE $01              01
0547 .BYTE $06              06
0548 .BYTE $04              04
0549 .BYTE $00              00
054A BWRTR2 
054A .BYTE $05              05
054B .BYTE $04              04
054C .BYTE $00              00
054D .BYTE $09              09
054E .BYTE $03              03
054F .BYTE $01              01
0550 .BYTE $08              08
0551 .BYTE $07              07
0552 .BYTE $02              02
0553 .BYTE $06              06
0554 BWRTR3 
0554 .BYTE $07              07
0555 .BYTE $04              04
0556 .BYTE $06              06
0557 .BYTE $01              01
0558 .BYTE $00              00
0559 .BYTE $02              02
055A .BYTE $05              05
055B .BYTE $08              08
055C .BYTE $03              03
055D .BYTE $09              09

055E KEYTBL 
055E .BYTE $10              10
055F INC_V1 
055F .BYTE $0C              0C
0560 DEV_V1 
0560 .BYTE $11              11
0561 INC_V2 
0561 .BYTE $0D              0D
0562 DEV_V2 
0562 .BYTE $14              14
0563 INC_V3 
0563 .BYTE $0E              0E
0564 DEV_V3 
0564 .BYTE $12              12
0565 INC_V4 
0565 .BYTE $0F              0F
0566 DEV_V4 

0566 INIT   

0566        CLD             D8
0567        LDA #$00        A9 00
0569 REM_RO 
0569        CMP *ENIGVA     C5 50
056B        BNE INITOK      D0 10

056D ZEROIZ 
056D        LDA #$0E        A9 0E
056F REM_14 
056F        STA *TMP01      85 5E
0571        LDX #$00        A2 00

0573 CPYINI 
0573        LDA DEFVAL,X    BD 06 05
0576        STA *ENIGV1,X   95 4F
0578        INX             E8
0579        DEC *TMP01      C6 5E
057B        BNE CPYINI      D0 F6

057D INITOK 

057D START  

057D        JSR TIMEOU      20 BB 05

0580        JSR SHOWEN      20 CA 05

0583        JSR SCANS       20 1F 1F
0586        JSR GETKEY      20 6A 1F

0589        CMP #$15        C9 15
058B        BCS START       B0 F0
058D REM_IF 

058D        CMP #$0A        C9 0A
058F        BCC SKIPMR      90 12
0591 REM_IF 

0591        CMP #$0A        C9 0A
0593        BEQ KPUSHA      F0 1D

0595        CMP #$0B        C9 0B
0597        BEQ KPUSHB      F0 1C

0599        CMP #$13        C9 13
059B        BEQ KPUSHG      F0 1B

059D        JSR MOVROT      20 E5 05
05A0        JMP START       4C 7D 05

05A3 SKIPMR 
05A3        STA *KEYIN      85 5B
05A5        JSR STEPRT      20 29 06
05A8        JSR ENIGMA      20 94 06

05AB        LDA #$50        A9 50
05AD        STA *TIMEO1     85 5D

05AF        JMP START       4C 7D 05

05B2 KPUSHA 
05B2        JMP START       4C 7D 05
05B5 KPUSHB 
05B5        JMP SETUP       4C F5 06
05B8 KPUSHG 
05B8        JMP ZEROIZ      4C 6D 05


05BB REM_SU 
05BB TIMEOU 

05BB        LDA #$00        A9 00
05BD        CMP *TIMEO1     C5 5D
05BF        BEQ TIMEOS      F0 08
05C1        DEC *TIMEO1     C6 5D
05C3        BNE TIMEOS      D0 04

05C5        STA *KEYIN      85 5B
05C7        STA *KEYOUT     85 5C

05C9 TIMEOS 
05C9        RTS             60


05CA REM_SU 
05CA SHOWEN 

05CA        LDX #$00        A2 00
05CC        LDY #$03        A0 03
05CE SHOWND 
05CE        LDA *ROTORS,X   B5 57
05D0        ASL A           0A
05D1        ASL A           0A
05D2        ASL A           0A
05D3        ASL A           0A
05D4        STA $00F8,Y     99 F8 00
05D7        INX             E8
05D8        LDA *ROTORS,X   B5 57
05DA        ORA $00F8,Y     19 F8 00
05DD        STA $00F8,Y     99 F8 00
05E0        INX             E8
05E1        DEY             88
05E2        BNE SHOWND      D0 EA

05E4        RTS             60


05E5 REM_SU 
05E5 MOVROT 

05E5        LDX *$00        A6 00
05E7        LDY *$04        A4 04
05E9        STX *TMP01      86 5E

05EB MOVRSC 
05EB        CMP KEYTBL,X    DD 5E 05
05EE        BEQ MOVRIN      F0 0D
05F0        CMP INC_V1,X    DD 5F 05
05F3        BEQ MOVRDE      F0 0F
05F5        INC *TMP01      E6 5E
05F7        INX             E8
05F8        INX             E8
05F9        DEY             88
05FA        BNE MOVRSC      D0 EF
05FC        RTS             60

05FD MOVRIN 
05FD        LDX *TMP01      A6 5E
05FF        INC *ROTORS,X   F6 57
0601        JMP MOVRCK      4C 08 06

0604 MOVRDE 
0604        LDX *TMP01      A6 5E
0606        DEC *ROTORS,X   D6 57

0608 REM_JM 

0608 MOVRCK 
0608        LDA #$00        A9 00
060A        STA *KEYIN      85 5B
060C        STA *KEYOUT     85 5C

060E        JSR ROLLOV      20 12 06

0611        RTS             60


0612 REM_SU 

0612 REM_CA 

0612 REM_TO 

0612 REM_AF 
0612 ROLLOV 

0612        LDA #$FF        A9 FF
0614        CMP *ROTORS,X   D5 57
0616        BEQ ROLLO9      F0 07

0618        LDA #$0A        A9 0A
061A        CMP *ROTORS,X   D5 57
061C        BEQ ROLLO0      F0 06

061E        RTS             60

061F ROLLO9 
061F        LDA #$09        A9 09
0621        STA *ROTORS,X   95 57
0623        RTS             60

0624 ROLLO0 
0624        LDA #$00        A9 00
0626        STA *ROTORS,X   95 57
0628        RTS             60


0629 REM_SU 
0629 STEPRT 

0629        LDA #$00        A9 00
062B        CMP *ENIGV1     C5 4F
062D        BEQ STEPLV      F0 14

062F STEPGR 

062F        LDA #$09        A9 09
0631        LDX #$03        A2 03
0633        LDY #$0F        A0 0F

0635 STEPGN 

0635        CMP *ROTORS,X   D5 57
0637        BEQ STEPGO      F0 02

0639        LDY #$00        A0 00

063B STEPGO 

063B        DEX             CA
063C        STY *TMP02,X    94 5F

063E        BNE STEPGN      D0 F5

0640        CLC             18
0641        BCC STEPPL      90 15

0643 STEPLV 

0643        LDX #$01        A2 01
0645        LDY #$03        A0 03

0647 STEPSC 
0647        LDA #$00        A9 00

0649 REM_OL 

0649 JSR_EN 
0649        LDA *ROTORS,X   B5 57
064B        NOP             EA

064C        CMP #$09        C9 09
064E        BEQ STEPDN      F0 02
0650        LDA #$00        A9 00
0652 STEPDN 
0652        STA *TMP01,X    95 5E
0654        INX             E8
0655        DEY             88
0656        BNE STEPSC      D0 EF

0658 STEPPL 

0658 REM_Y_ 
0658        LDX #$00        A2 00
065A        LDY #$00        A0 00
065C        STY *TMP01      84 5E
065E        LDA #$04        A9 04
0660        STA *TMP05      85 62
0662 REM_IN 
0662        STA *TMP06      85 63

0664 STEPIW 
0664        LDA *TMP01,X    B5 5E
0666        STY *TMP01,X    94 5E
0668        INX             E8
0669        CLC             18
066A        ADC *TMP01,X    75 5E
066C        CMP #$00        C9 00
066E        BEQ STEPS3      F0 0D
0670        CMP #$0F        C9 0F
0672        BNE STEPIK      D0 02
0674        STY *TMP01,X    94 5E

0676 STEPIK 
0676        DEX             CA
0677        INC *ROTORS,X   F6 57
0679        JSR ROLLOV      20 12 06
067C        INX             E8

067D STEPS3 
067D        DEC *TMP06      C6 63
067F        BNE STEPIW      D0 E3

0681        RTS             60


0682 REM_SU 

0682 CALL_W 

0682 CALL_W 
0682 ENRING 

0682        SEC             38
0683        ADC *ROTORS,X   75 57
0685 REM_PL 
0685        CMP #$0A        C9 0A
0687        BCC ENRIK1      90 02
0689 REM_AB 
0689        SBC #$0A        E9 0A
068B REM_CA 

068B ENRIK1 
068B        SEC             38
068C        SBC *RINGST,X   F5 53
068E        BCS ENRIK2      B0 02
0690        ADC #$0A        69 0A

0692 ENRIK2 
0692        CLC             18
0693        RTS             60


0694 REM_SU 
0694 ENIGMA 

0694        LDA #$FF        A9 FF
0696        STA *TMP03      85 60

0698        LDA #$00        A9 00
069A        STA *TMP04      85 61

069C        LDY #$07        A0 07
069E        LDX #$03        A2 03
06A0        LDA *KEYIN      A5 5B

06A2 ENIGM2 
06A2        JSR ENRING      20 82 06

06A5        STX *TMP01      86 5E

06A7        PHA             48
06A8        TXA             8A
06A9        CMP #$00        C9 00
06AB        BEQ ENIGXO      F0 03

06AD        LDA *ENIGV1,X   B5 4F
06AF        TAX             AA

06B0 ENIGXO 
06B0        PLA             68

06B1        CLC             18
06B2        ADC *TMP04      65 61
06B4        ADC ROTIDX,X    7D 14 05
06B7        TAX             AA
06B8        LDA FWRTR1,X    BD 18 05

06BB        PHA             48
06BC        LDA #$00        A9 00
06BE        LDX *TMP01      A6 5E
06C0        JSR ENRING      20 82 06
06C3        STA *TMP02      85 5F
06C5        PLA             68

06C6        SEC             38
06C7        SBC *TMP02      E5 5F
06C9        BCS ENIGM3      B0 02
06CB        ADC #$0A        69 0A

06CD ENIGM3 

06CD        STA *KEYOUT     85 5C

06CF        TYA             98

06D0        CMP #$04        C9 04
06D2        BNE ENIGNB      D0 08


06D4 REM_SE 

06D4        LDA #$01        A9 01
06D6        STA *TMP03      85 60

06D8        LDA #$28        A9 28
06DA        STA *TMP04      85 61

06DC ENIGNB 

06DC        TXA             8A
06DD        CLC             18
06DE        ADC *TMP03      65 60
06E0        TAX             AA

06E1        LDA *KEYOUT     A5 5C

06E3        DEY             88
06E4        BNE ENIGM2      D0 BC

06E6        RTS             60


06E7 REM_SU 

06E7 REM_A_ 

06E7 REM_FR 

06E7 REM_TO 

06E7 COPY   
06E7        STA *TMP01      85 5E
06E9        LDA *$00,X      B5 00
06EB        STA $0000,Y     99 00 00
06EE        INX             E8
06EF        INY             C8
06F0        DEC *TMP01      C6 5E
06F2        BNE COPY        D0 F3
06F4        RTS             60


06F5 REM_SU 
06F5 SETUP  
06F5        LDA #$04        A9 04
06F7        LDX #ROTORS     A2 57
06F9        LDY #TMP06      A0 63
06FB        JSR COPY        20 E7 06

06FE        LDA #$03        A9 03
0700        LDX #ENIGVA     A2 50
0702        LDY #LROTOR     A0 58
0704        JSR COPY        20 E7 06

0707 SETF1  

0707        LDX #$0F        A2 0F
0709        STX *KEYIN      86 5B
070B        LDX #$00        A2 00
070D        STX *ROTORS     86 57
070F        INX             E8
0710        STX *KEYOUT     86 5C

0712 SETWHL 
0712        JSR SHOWEN      20 CA 05
0715        JSR SCANS       20 1F 1F
0718        JSR GETKEY      20 6A 1F

071B        CMP #$15        C9 15
071D        BCS SETWHL      B0 F3
071F REM_IF 

071F        CMP #$13        C9 13
0721 REM_GO 
0721        BNE SETNGO      D0 03
0723        JMP ZEROIZ      4C 6D 05
0726 REM_SE 
0726 SETNGO 

0726        CMP #$0B        C9 0B
0728        BCC SETWHL      90 E8
072A REM_IF 

072A        CMP #$0B        C9 0B
072C        BEQ SETCHK      F0 1D

072E        JSR MOVROT      20 E5 05

0731        LDX #$03        A2 03
0733        STX *TMP02      86 5F
0735 REM_US 

0735 SETOVF 
0735        LDA *ROTORS,X   B5 57
0737        CMP #$00        C9 00
0739        BNE SETNZ       D0 02
073B        LDA #$03        A9 03
073D SETNZ  
073D        CMP #$04        C9 04
073F        BNE SETNF       D0 02
0741        LDA #$01        A9 01
0743 SETNF  
0743        STA *ROTORS,X   95 57
0745        DEX             CA
0746        BNE SETOVF      D0 ED

0748        JMP SETF1       4C 07 07

074B SETCHK 

074B        LDX #$00        A2 00
074D        STX *TMP03      86 60
074F        STX *TMP04      86 61
0751        STX *TMP05      86 62

0753 SETCHL 
0753        LDX *TMP02      A6 5F
0755        LDA *ROTORS,X   B5 57
0757        CMP #$00        C9 00
0759        BEQ SETCHG      F0 04
075B        CMP #$04        C9 04
075D REM_CH 
075D        BCC SETCHO      90 02
075F REM_3_ 

075F SETCHG 
075F        LDA #$01        A9 01

0761 SETCHO 
0761        TAX             AA
0762        LDA #$01        A9 01
0764        STA *TMP02,X    95 5F
0766        DEC *TMP02      C6 5F
0768        BNE SETCHL      D0 E9

076A        LDX #$03        A2 03
076C        LDA #$00        A9 00
076E        LDY #$00        A0 00
0770 SETCHD 
0770        CLC             18
0771        ADC *TMP02,X    75 5F
0773        STY *TMP02,X    94 5F
0775        DEX             CA
0776        BNE SETCHD      D0 F8

0778        CMP #$03        C9 03
077A        BEQ SETUOK      F0 09

077C        LDX #$0E        A2 0E
077E        STX *KEYIN      86 5B
0780        STX *KEYOUT     86 5C
0782        JMP SETWHL      4C 12 07

0785 SETUOK 

0785        LDA #$03        A9 03
0787        LDX #LROTOR     A2 58
0789        LDY #ENIGVA     A0 50
078B        JSR COPY        20 E7 06

078E        LDA #$04        A9 04
0790        LDX #RINGST     A2 53
0792        LDY #ROTORS     A0 57
0794        JSR COPY        20 E7 06

0797 SETF2  

0797        LDX #$0F        A2 0F
0799        STX *KEYIN      86 5B
079B        LDX #$02        A2 02
079D        STX *KEYOUT     86 5C

079F SETRNG 
079F        JSR SHOWEN      20 CA 05
07A2        JSR SCANS       20 1F 1F
07A5        JSR GETKEY      20 6A 1F

07A8        CMP #$15        C9 15
07AA        BCS SETRNG      B0 F3
07AC REM_IF 

07AC        CMP #$13        C9 13
07AE REM_GO 
07AE        BNE RNGNGO      D0 03
07B0        JMP ZEROIZ      4C 6D 05
07B3 REM_SE 
07B3 RNGNGO 

07B3        CMP #$0B        C9 0B
07B5        BCC SETRNG      90 E8
07B7 REM_IF 

07B7        CMP #$0B        C9 0B
07B9        BEQ RNGCHK      F0 06

07BB        JSR MOVROT      20 E5 05

07BE        JMP SETF2       4C 97 07

07C1 RNGCHK 

07C1        LDA #$04        A9 04
07C3        LDX #ROTORS     A2 57
07C5        LDY #RINGST     A0 53
07C7        JSR COPY        20 E7 06

07CA        LDA #$04        A9 04
07CC        LDX #TMP06      A2 63
07CE        LDY #ROTORS     A0 57
07D0        JSR COPY        20 E7 06

07D3        LDX #$00        A2 00
07D5        STX *KEYIN      86 5B
07D7        STX *KEYOUT     86 5C

07D9        JSR SHOWEN      20 CA 05
07DC        JMP START       4C 7D 05

done.
