pass 2

0000 TODO:  


0000 REM_TO 

0000 REM_IS 

* = $0500
0500 ENIGV1 = 004F
0500 ONE_LE 
0500 ENIGVA = 0050
0500 RINGST = 0053
0500 REM_RO 
0500 ROTORS = 0057
0500 REM_RE 
0500 LROTOR = 0058
0500 KEYIN  = 005B
0500 KEYOUT = 005C

0500 TIMEO1 = 005D
0500 TMP01  = 005E
0500 TMP02  = 005F
0500 TMP03  = 0060
0500 TMP04  = 0061
0500 TMP05  = 0062
0500 TMP06  = 0063

0500 DISP3  = 00F9

0500 GETKEY = 1F6A
0500 SCANS  = 1F1F

0500        JMP INIT        4C 66 05

0503 GEARTX 
0503 .BYTE $06              06
0504 .BYTE $0E              0E
0505 .BYTE $0A              0A

0506 DEFVAL 
0506 .BYTE $00              00
0507 .BYTE $01              01
0508 .BYTE $02              02
0509 .BYTE $03              03
050A .BYTE $01              01
050B .BYTE $01              01
050C .BYTE $01              01
050D .BYTE $01              01
050E .BYTE $04              04
050F .BYTE $03              03
0510 .BYTE $02              02
0511 .BYTE $01              01
0512 .BYTE $00              00
0513 .BYTE $00              00

0514 ROTIDX 
0514 .BYTE $1E              1E
0515 .BYTE $00              00
0516 .BYTE $0A              0A
0517 .BYTE $14              14

0518 FWRTR1 
0518 .BYTE $09              09
0519 .BYTE $06              06
051A .BYTE $04              04
051B .BYTE $01              01
051C .BYTE $08              08
051D .BYTE $02              02
051E .BYTE $07              07
051F .BYTE $00              00
0520 .BYTE $03              03
0521 .BYTE $05              05
0522 FWRTR2 
0522 .BYTE $02              02
0523 .BYTE $05              05
0524 .BYTE $08              08
0525 .BYTE $04              04
0526 .BYTE $01              01
0527 .BYTE $00              00
0528 .BYTE $09              09
0529 .BYTE $07              07
052A .BYTE $06              06
052B .BYTE $03              03
052C FWRTR3 
052C .BYTE $04              04
052D .BYTE $03              03
052E .BYTE $05              05
052F .BYTE $08              08
0530 .BYTE $01              01
0531 .BYTE $06              06
0532 .BYTE $02              02
0533 .BYTE $00              00
0534 .BYTE $07              07
0535 .BYTE $09              09
0536 REFLEC 
0536 .BYTE $02              02
0537 .BYTE $05              05
0538 .BYTE $00              00
0539 .BYTE $07              07
053A .BYTE $09              09
053B .BYTE $01              01
053C .BYTE $08              08
053D .BYTE $03              03
053E .BYTE $06              06
053F .BYTE $04              04
0540 BWRTR1 
0540 .BYTE $07              07
0541 .BYTE $03              03
0542 .BYTE $05              05
0543 .BYTE $08              08
0544 .BYTE $02              02
0545 .BYTE $09              09
0546 .BYTE $01              01
0547 .BYTE $06              06
0548 .BYTE $04              04
0549 .BYTE $00              00
054A BWRTR2 
054A .BYTE $05              05
054B .BYTE $04              04
054C .BYTE $00              00
054D .BYTE $09              09
054E .BYTE $03              03
054F .BYTE $01              01
0550 .BYTE $08              08
0551 .BYTE $07              07
0552 .BYTE $02              02
0553 .BYTE $06              06
0554 BWRTR3 
0554 .BYTE $07              07
0555 .BYTE $04              04
0556 .BYTE $06              06
0557 .BYTE $01              01
0558 .BYTE $00              00
0559 .BYTE $02              02
055A .BYTE $05              05
055B .BYTE $08              08
055C .BYTE $03              03
055D .BYTE $09              09

055E KEYTBL 
055E .BYTE $10              10
055F INC_V1 
055F .BYTE $0C              0C
0560 DEV_V1 
0560 .BYTE $11              11
0561 INC_V2 
0561 .BYTE $0D              0D
0562 DEV_V2 
0562 .BYTE $14              14
0563 INC_V3 
0563 .BYTE $0E              0E
0564 DEV_V3 
0564 .BYTE $12              12
0565 INC_V4 
0565 .BYTE $0F              0F
0566 DEV_V4 

0566 INIT   

0566        CLD             D8
0567        LDA #$00        A9 00
0569 REM_RO 
0569        CMP *ENIGVA     C5 50
056B        BNE INITOK      D0 10

056D ZEROIZ 
056D        LDA #$11        A9 11
056F REM_14 
056F        STA *TMP01      85 5E
0571        LDX #$00        A2 00

0573 CPYINI 
0573        LDA GEARTX,X    BD 03 05
0576        STA *$4C,X      95 4C
0578        INX             E8
0579        DEC *TMP01      C6 5E
057B        BNE CPYINI      D0 F6

057D INITOK 

057D START  

057D        JSR TIMEOU      20 BB 05

0580 MNURET 

0580        JSR SHOWEN      20 CA 05

0583        JSR SCANS       20 1F 1F
0586        JSR GETKEY      20 6A 1F

0589        CMP #$15        C9 15
058B        BCS START       B0 F0
058D REM_IF 

058D        CMP #$0A        C9 0A
058F        BCC SKIPMR      90 12
0591 REM_IF 

0591        CMP #$0A        C9 0A
0593        BEQ KPUSHA      F0 1D

0595        CMP #$0B        C9 0B
0597        BEQ KPUSHB      F0 1C

0599        CMP #$13        C9 13
059B        BEQ KPUSHG      F0 1B

059D        JSR MOVROT      20 E5 05
05A0        JMP START       4C 7D 05

05A3 SKIPMR 
05A3        STA *KEYIN      85 5B
05A5        JSR STEPRT      20 29 06
05A8        JSR ENIGMA      20 94 06

05AB        LDA #$50        A9 50
05AD        STA *TIMEO1     85 5D

05AF        JMP START       4C 7D 05

05B2 KPUSHA 
05B2        JMP START       4C 7D 05
05B5 KPUSHB 
05B5        JMP SETUP       4C 16 07
05B8 KPUSHG 
05B8        JMP ZEROIZ      4C 6D 05


05BB REM_SU 
05BB TIMEOU 

05BB        LDA #$00        A9 00
05BD        CMP *TIMEO1     C5 5D
05BF        BEQ TIMEOS      F0 08
05C1        DEC *TIMEO1     C6 5D
05C3        BNE TIMEOS      D0 04

05C5 TIMEOC 
05C5        STA *KEYIN      85 5B
05C7        STA *KEYOUT     85 5C

05C9 TIMEOS 
05C9        RTS             60


05CA REM_SU 
05CA SHOWEN 

05CA        LDX #$00        A2 00
05CC        LDY #$03        A0 03
05CE SHOWND 
05CE        LDA *ROTORS,X   B5 57
05D0        ASL A           0A
05D1        ASL A           0A
05D2        ASL A           0A
05D3        ASL A           0A
05D4        STA $00F8,Y     99 F8 00
05D7        INX             E8
05D8        LDA *ROTORS,X   B5 57
05DA        ORA $00F8,Y     19 F8 00
05DD        STA $00F8,Y     99 F8 00
05E0        INX             E8
05E1        DEY             88
05E2        BNE SHOWND      D0 EA

05E4        RTS             60


05E5 REM_SU 
05E5 MOVROT 

05E5        LDX *$00        A6 00
05E7        LDY *$04        A4 04
05E9        STX *TMP01      86 5E

05EB MOVRSC 
05EB        CMP KEYTBL,X    DD 5E 05
05EE        BEQ MOVRIN      F0 0D
05F0        CMP INC_V1,X    DD 5F 05
05F3        BEQ MOVRDE      F0 0F
05F5        INC *TMP01      E6 5E
05F7        INX             E8
05F8        INX             E8
05F9        DEY             88
05FA        BNE MOVRSC      D0 EF
05FC        RTS             60

05FD MOVRIN 
05FD        LDX *TMP01      A6 5E
05FF        INC *ROTORS,X   F6 57
0601        JMP MOVRCK      4C 08 06

0604 MOVRDE 
0604        LDX *TMP01      A6 5E
0606        DEC *ROTORS,X   D6 57

0608 MOVRCK 
0608        LDA #$00        A9 00
060A        JSR TIMEOC      20 C5 05


060D REM_CO 

060D AND_RE 

060D        NOP             EA
060E        NOP             EA
060F        NOP             EA
0610        NOP             EA
0611        NOP             EA


0612 REM_SU 

0612 REM_CA 

0612 REM_TO 

0612 REM_AF 

0612 ROLLOV 

0612        LDA *ROTORS,X   B5 57
0614        CMP #$FF        C9 FF
0616        BNE ROLL09      D0 02
0618        LDA #$09        A9 09
061A ROLL09 
061A        CMP #$0A        C9 0A
061C        BNE ROLL00      D0 02
061E        LDA #$00        A9 00
0620 ROLL00 
0620        STA *ROTORS,X   95 57
0622        RTS             60

0623        NOP             EA
0624        NOP             EA
0625        NOP             EA
0626        NOP             EA
0627        NOP             EA
0628        NOP             EA


0629 REM_SU 

0629 REM_CA 

0629 REM_IN 
0629 STEPRT 

0629        LDA #$00        A9 00
062B        CMP *ENIGV1     C5 4F
062D        BEQ STEPLV      F0 14

062F STEPGR 

062F        LDA #$09        A9 09
0631        LDX #$03        A2 03
0633        LDY #$0F        A0 0F

0635 STEPGN 

0635        CMP *ROTORS,X   D5 57
0637        BEQ STEPGO      F0 02

0639        LDY #$00        A0 00

063B STEPGO 

063B        DEX             CA
063C        STY *TMP02,X    94 5F

063E        BNE STEPGN      D0 F5

0640        CLC             18
0641        BCC STEPPL      90 15

0643 STEPLV 

0643        LDX #$01        A2 01
0645        LDY #$03        A0 03

0647 STEPSC 
0647        LDA #$00        A9 00

0649 REM_OL 

0649 JSR_EN 
0649        LDA *ROTORS,X   B5 57
064B        NOP             EA

064C        CMP #$09        C9 09
064E        BEQ STEPDN      F0 02
0650        LDA #$00        A9 00
0652 STEPDN 
0652        STA *TMP01,X    95 5E
0654        INX             E8
0655        DEY             88
0656        BNE STEPSC      D0 EF

0658 STEPPL 

0658 REM_Y_ 
0658        LDX #$00        A2 00
065A        LDY #$00        A0 00
065C        STY *TMP01      84 5E
065E        LDA #$04        A9 04
0660        STA *TMP05      85 62
0662 REM_IN 
0662        STA *TMP06      85 63

0664 STEPIW 
0664        LDA *TMP01,X    B5 5E
0666        STY *TMP01,X    94 5E
0668        INX             E8
0669        CLC             18
066A        ADC *TMP01,X    75 5E
066C        CMP #$00        C9 00
066E        BEQ STEPS3      F0 0D
0670        CMP #$0F        C9 0F
0672        BNE STEPIK      D0 02
0674        STY *TMP01,X    94 5E

0676 STEPIK 
0676        DEX             CA
0677        INC *ROTORS,X   F6 57
0679        JSR ROLLOV      20 12 06
067C        INX             E8

067D STEPS3 
067D        DEC *TMP06      C6 63
067F        BNE STEPIW      D0 E3

0681        RTS             60


0682 REM_SU 

0682 CALL_W 

0682 CALL_W 
0682 ENRING 

0682        SEC             38
0683        ADC *ROTORS,X   75 57
0685 REM_PL 
0685        CMP #$0A        C9 0A
0687        BCC ENRIK1      90 02
0689 REM_AB 
0689        SBC #$0A        E9 0A
068B REM_CA 

068B ENRIK1 
068B        SEC             38
068C        SBC *RINGST,X   F5 53
068E        BCS ENRIK2      B0 02
0690        ADC #$0A        69 0A

0692 ENRIK2 
0692        CLC             18
0693        RTS             60


0694 REM_SU 
0694 ENIGMA 

0694        LDA #$FF        A9 FF
0696        STA *TMP03      85 60

0698        LDA #$00        A9 00
069A        STA *TMP04      85 61

069C        LDY #$07        A0 07
069E        LDX #$03        A2 03
06A0        LDA *KEYIN      A5 5B

06A2 ENIGM2 
06A2        JSR ENRING      20 82 06

06A5        STX *TMP01      86 5E

06A7        PHA             48
06A8        TXA             8A
06A9        CMP #$00        C9 00
06AB        BEQ ENIGXO      F0 03

06AD        LDA *ENIGV1,X   B5 4F
06AF        TAX             AA

06B0 ENIGXO 
06B0        PLA             68

06B1        CLC             18
06B2        ADC *TMP04      65 61
06B4        ADC ROTIDX,X    7D 14 05
06B7        TAX             AA
06B8        LDA FWRTR1,X    BD 18 05

06BB        PHA             48
06BC        LDA #$00        A9 00
06BE        LDX *TMP01      A6 5E
06C0        JSR ENRING      20 82 06
06C3        STA *TMP02      85 5F
06C5        PLA             68

06C6        SEC             38
06C7        SBC *TMP02      E5 5F
06C9        BCS ENIGM3      B0 02
06CB        ADC #$0A        69 0A

06CD ENIGM3 

06CD        STA *KEYOUT     85 5C

06CF        TYA             98

06D0        CMP #$04        C9 04
06D2        BNE ENIGNB      D0 08


06D4 REM_SE 

06D4        LDA #$01        A9 01
06D6        STA *TMP03      85 60

06D8        LDA #$28        A9 28
06DA        STA *TMP04      85 61

06DC ENIGNB 

06DC        TXA             8A
06DD        CLC             18
06DE        ADC *TMP03      65 60
06E0        TAX             AA

06E1        LDA *KEYOUT     A5 5C

06E3        DEY             88
06E4        BNE ENIGM2      D0 BC

06E6        RTS             60


06E7 REM_SU 

06E7 REM_A_ 

06E7 REM_FR 

06E7 REM_TO 
06E7 COPY   
06E7        STA *TMP01      85 5E

06E9 COPYDO 
06E9        LDA *$00,X      B5 00
06EB        STA $0000,Y     99 00 00
06EE        INX             E8
06EF        INY             C8
06F0        DEC *TMP01      C6 5E
06F2        BNE COPYDO      D0 F5
06F4        RTS             60


06F5 REM_SU 
06F5 READKY 

06F5        LDX #$0F        A2 0F
06F7        STX *KEYIN      86 5B

06F9        JSR SHOWEN      20 CA 05
06FC        JSR SCANS       20 1F 1F
06FF        JSR GETKEY      20 6A 1F

0702        CMP #$15        C9 15
0704        BCS READKY      B0 EF
0706 REM_IF 

0706        CMP #$13        C9 13
0708 REM_GO 
0708        BNE READKG      D0 07
070A        TSX             BA
070B BALANC 
070B        INX             E8
070C        INX             E8
070D DISCAR 
070D        TXS             9A
070E AND_BA 
070E        JMP ZEROIZ      4C 6D 05
0711 REM_SE 
0711 READKG 

0711        CMP #$0B        C9 0B
0713        BCC READKY      90 E0
0715 REM_IF 

0715        RTS             60


0716 REM_SU 
0716 SETUP  
0716        LDA #$04        A9 04
0718        LDX #ROTORS     A2 57
071A        LDY #TMP06      A0 63
071C        JSR COPY        20 E7 06

071F        LDA #$03        A9 03
0721        LDX #ENIGVA     A2 50
0723        LDY #LROTOR     A0 58
0725        JSR COPY        20 E7 06

0728 SETF1  

0728        LDX #$00        A2 00
072A        STX *ROTORS     86 57
072C        INX             E8
072D        STX *KEYOUT     86 5C

072F SETF1E 

072F        JSR READKY      20 F5 06

0732        CMP #$0B        C9 0B
0734        BEQ SETCHK      F0 1B

0736        JSR MOVROT      20 E5 05

0739        LDX #$03        A2 03
073B REM_OV 
073B SETOVF 
073B REM_TU 
073B        LDA *ROTORS,X   B5 57
073D        CMP #$00        C9 00
073F        BNE SETNZ       D0 02
0741        LDA #$03        A9 03
0743 SETNZ  
0743        CMP #$04        C9 04
0745        BNE SETNF       D0 02
0747        LDA #$01        A9 01
0749 SETNF  
0749        STA *ROTORS,X   95 57
074B        DEX             CA
074C        BNE SETOVF      D0 ED

074E        JMP SETF1       4C 28 07

0751 SETCHK 

0751        LDX #$03        A2 03
0753        STX *TMP02      86 5F

0755        LDX #$00        A2 00
0757        STX *TMP03      86 60
0759        STX *TMP04      86 61
075B        STX *TMP05      86 62

075D SETCHL 
075D        LDX *TMP02      A6 5F
075F        LDA *ROTORS,X   B5 57
0761        TAX             AA
0762        LDA #$01        A9 01
0764        STA *TMP02,X    95 5F
0766        DEC *TMP02      C6 5F
0768        BNE SETCHL      D0 F3

076A        LDX #$03        A2 03
076C        LDA #$00        A9 00
076E        TAY             A8
076F SETCHD 
076F        CLC             18
0770        ADC *TMP02,X    75 5F
0772        STY *TMP02,X    94 5F
0774        DEX             CA
0775        BNE SETCHD      D0 F8

0777        CMP #$03        C9 03
0779        BEQ SETUOK      F0 08

077B        LDA #$0E        A9 0E
077D        JSR TIMEOC      20 C5 05
0780        JMP SETF1E      4C 2F 07

0783 SETUOK 

0783        LDA #$03        A9 03
0785        LDX #LROTOR     A2 58
0787        LDY #ENIGVA     A0 50
0789        JSR COPY        20 E7 06

078C        LDA #$04        A9 04
078E        LDX #RINGST     A2 53
0790        LDY #ROTORS     A0 57
0792        JSR COPY        20 E7 06

0795 SETF2  

0795        LDX #$02        A2 02
0797        STX *KEYOUT     86 5C

0799        JSR READKY      20 F5 06

079C        CMP #$0B        C9 0B
079E        BEQ RNGCHK      F0 06

07A0        JSR MOVROT      20 E5 05

07A3        JMP SETF2       4C 95 07

07A6 RNGCHK 

07A6        LDA #$04        A9 04
07A8        LDX #ROTORS     A2 57
07AA        LDY #RINGST     A0 53
07AC        JSR COPY        20 E7 06

07AF SETF3  

07AF        LDA #$03        A9 03
07B1        LDX #$4C        A2 4C
07B3        LDY #ROTORS     A0 57
07B5        JSR COPY        20 E7 06

07B8        LDX #$03        A2 03
07BA        STX *KEYOUT     86 5C

07BC        LDA *ENIGV1     A5 4F
07BE        STA *$5A        85 5A

07C0        JSR READKY      20 F5 06

07C3        CMP #$0B        C9 0B
07C5        BEQ GEACHK      F0 16

07C7        JSR MOVROT      20 E5 05

07CA        LDA *$5A        A5 5A
07CC        CMP #$09        C9 09
07CE        BNE F3NOOV      D0 02
07D0        LDA #$01        A9 01
07D2 F3NOOV 
07D2        CMP #$02        C9 02
07D4        BNE F3NOUF      D0 02
07D6        LDA #$00        A9 00
07D8 F3NOUF 
07D8        STA *ENIGV1     85 4F

07DA        JMP SETF3       4C AF 07

07DD GEACHK 

07DD        LDA #$04        A9 04
07DF        LDX #TMP06      A2 63
07E1        LDY #ROTORS     A0 57
07E3        JSR COPY        20 E7 06

07E6        LDA #$00        A9 00
07E8        JSR TIMEOC      20 C5 05

07EB        JMP MNURET      4C 80 05


done.
