pass 2

0000 TODO:  


0000 REM_TO 

0000 REM_IS 

* = $0500
0500 ENIGV1 = 004F
0500 ONE_LE 
0500 ENIGVA = 0050
0500 RINGST = 0053
0500 REM_RO 
0500 ROTORS = 0057
0500 REM_RE 
0500 LROTOR = 0058
0500 KEYIN  = 005B
0500 KEYOUT = 005C

0500 TIMEO1 = 005D
0500 TMP01  = 005E
0500 TMP02  = 005F
0500 TMP03  = 0060
0500 TMP04  = 0061
0500 TMP05  = 0062
0500 TMP06  = 0063

0500 DISP3  = 00F9

0500 GETKEY = 1F6A
0500 SCANS  = 1F1F

0500        JMP INIT        4C 66 05

0503 GEARTX 
0503 .BYTE $06              06
0504 .BYTE $0E              0E
0505 .BYTE $0A              0A

0506 DEFVAL 
0506 .BYTE $00              00
0507 .BYTE $01              01
0508 .BYTE $02              02
0509 .BYTE $03              03
050A .BYTE $01              01
050B .BYTE $01              01
050C .BYTE $01              01
050D .BYTE $01              01
050E .BYTE $04              04
050F .BYTE $03              03
0510 .BYTE $02              02
0511 .BYTE $01              01
0512 .BYTE $00              00
0513 .BYTE $00              00

0514 ROTIDX 
0514 .BYTE $1E              1E
0515 .BYTE $00              00
0516 .BYTE $0A              0A
0517 .BYTE $14              14

0518 FWRTR1 
0518 .BYTE $09              09
0519 .BYTE $06              06
051A .BYTE $04              04
051B .BYTE $01              01
051C .BYTE $08              08
051D .BYTE $02              02
051E .BYTE $07              07
051F .BYTE $00              00
0520 .BYTE $03              03
0521 .BYTE $05              05
0522 FWRTR2 
0522 .BYTE $02              02
0523 .BYTE $05              05
0524 .BYTE $08              08
0525 .BYTE $04              04
0526 .BYTE $01              01
0527 .BYTE $00              00
0528 .BYTE $09              09
0529 .BYTE $07              07
052A .BYTE $06              06
052B .BYTE $03              03
052C FWRTR3 
052C .BYTE $04              04
052D .BYTE $03              03
052E .BYTE $05              05
052F .BYTE $08              08
0530 .BYTE $01              01
0531 .BYTE $06              06
0532 .BYTE $02              02
0533 .BYTE $00              00
0534 .BYTE $07              07
0535 .BYTE $09              09
0536 REFLEC 
0536 .BYTE $02              02
0537 .BYTE $05              05
0538 .BYTE $00              00
0539 .BYTE $07              07
053A .BYTE $09              09
053B .BYTE $01              01
053C .BYTE $08              08
053D .BYTE $03              03
053E .BYTE $06              06
053F .BYTE $04              04
0540 BWRTR1 
0540 .BYTE $07              07
0541 .BYTE $03              03
0542 .BYTE $05              05
0543 .BYTE $08              08
0544 .BYTE $02              02
0545 .BYTE $09              09
0546 .BYTE $01              01
0547 .BYTE $06              06
0548 .BYTE $04              04
0549 .BYTE $00              00
054A BWRTR2 
054A .BYTE $05              05
054B .BYTE $04              04
054C .BYTE $00              00
054D .BYTE $09              09
054E .BYTE $03              03
054F .BYTE $01              01
0550 .BYTE $08              08
0551 .BYTE $07              07
0552 .BYTE $02              02
0553 .BYTE $06              06
0554 BWRTR3 
0554 .BYTE $07              07
0555 .BYTE $04              04
0556 .BYTE $06              06
0557 .BYTE $01              01
0558 .BYTE $00              00
0559 .BYTE $02              02
055A .BYTE $05              05
055B .BYTE $08              08
055C .BYTE $03              03
055D .BYTE $09              09

055E KEYTBL 
055E .BYTE $10              10
055F INC_V1 
055F .BYTE $0C              0C
0560 DEV_V1 
0560 .BYTE $11              11
0561 INC_V2 
0561 .BYTE $0D              0D
0562 DEV_V2 
0562 .BYTE $14              14
0563 INC_V3 
0563 .BYTE $0E              0E
0564 DEV_V3 
0564 .BYTE $12              12
0565 INC_V4 
0565 .BYTE $0F              0F
0566 DEV_V4 

0566 INIT   

0566        CLD             D8
0567        LDA #$00        A9 00
0569 REM_RO 
0569        CMP *ENIGVA     C5 50
056B        BNE INITOK      D0 10

056D ZEROIZ 
056D        LDA #$11        A9 11
056F REM_14 
056F        STA *TMP01      85 5E
0571        LDX #$00        A2 00

0573 CPYINI 
0573        LDA GEARTX,X    BD 03 05
0576        STA *$4C,X      95 4C
0578        INX             E8
0579        DEC *TMP01      C6 5E
057B        BNE CPYINI      D0 F6

057D INITOK 

057D START  

057D        JSR TIMEOU      20 BB 05

0580 MNURET 

0580        JSR SHOWEN      20 CA 05

0583        JSR SCANS       20 1F 1F
0586        JSR GETKEY      20 6A 1F

0589        CMP #$15        C9 15
058B        BCS START       B0 F0
058D REM_IF 

058D        CMP #$0A        C9 0A
058F        BCC SKIPMR      90 12
0591 REM_IF 

0591        CMP #$0A        C9 0A
0593        BEQ KPUSHA      F0 1D

0595        CMP #$0B        C9 0B
0597        BEQ KPUSHB      F0 1C

0599        CMP #$13        C9 13
059B        BEQ KPUSHG      F0 1B

059D        JSR MOVROT      20 E5 05
05A0        JMP START       4C 7D 05

05A3 SKIPMR 
05A3        STA *KEYIN      85 5B
05A5        JSR STEPRT      20 1E 06
05A8        JSR ENIGMA      20 70 06

05AB        LDA #$50        A9 50
05AD        STA *TIMEO1     85 5D

05AF        JMP START       4C 7D 05

05B2 KPUSHA 
05B2        JMP START       4C 7D 05
05B5 KPUSHB 
05B5        JMP START       4C 7D 05
05B8 KPUSHG 
05B8        JMP ZEROIZ      4C 6D 05


05BB REM_SU 
05BB TIMEOU 

05BB        LDA #$00        A9 00
05BD        CMP *TIMEO1     C5 5D
05BF        BEQ TIMEOS      F0 08
05C1        DEC *TIMEO1     C6 5D
05C3        BNE TIMEOS      D0 04

05C5 TIMEOC 
05C5        STA *KEYIN      85 5B
05C7        STA *KEYOUT     85 5C

05C9 TIMEOS 
05C9        RTS             60


05CA REM_SU 
05CA SHOWEN 

05CA        LDX #$00        A2 00
05CC        LDY #$03        A0 03
05CE SHOWND 
05CE        LDA *ROTORS,X   B5 57
05D0        ASL A           0A
05D1        ASL A           0A
05D2        ASL A           0A
05D3        ASL A           0A
05D4        STA $00F8,Y     99 F8 00
05D7        INX             E8
05D8        LDA *ROTORS,X   B5 57
05DA        ORA $00F8,Y     19 F8 00
05DD        STA $00F8,Y     99 F8 00
05E0        INX             E8
05E1        DEY             88
05E2        BNE SHOWND      D0 EA

05E4        RTS             60


05E5 REM_SU 
05E5 MOVROT 

05E5        LDX *$00        A6 00
05E7        LDY *$04        A4 04
05E9        STX *TMP01      86 5E

05EB MOVRSC 
05EB        CMP KEYTBL,X    DD 5E 05
05EE        BEQ MOVRIN      F0 0D
05F0        CMP INC_V1,X    DD 5F 05
05F3        BEQ MOVRDE      F0 0F
05F5        INC *TMP01      E6 5E
05F7        INX             E8
05F8        INX             E8
05F9        DEY             88
05FA        BNE MOVRSC      D0 EF
05FC        RTS             60

05FD MOVRIN 
05FD        LDX *TMP01      A6 5E
05FF        INC *ROTORS,X   F6 57
0601        JMP MOVRCK      4C 08 06

0604 MOVRDE 
0604        LDX *TMP01      A6 5E
0606        DEC *ROTORS,X   D6 57

0608 MOVRCK 
0608        LDA #$00        A9 00
060A        JSR TIMEOC      20 C5 05


060D REM_CO 

060D AND_RE 


060D REM_SU 

060D REM_CA 

060D REM_TO 

060D REM_AF 

060D ROLLOV 

060D        LDA *ROTORS,X   B5 57
060F        CMP #$FF        C9 FF
0611        BNE ROLL09      D0 02
0613        LDA #$09        A9 09
0615 ROLL09 
0615        CMP #$0A        C9 0A
0617        BNE ROLL00      D0 02
0619        LDA #$00        A9 00
061B ROLL00 
061B        STA *ROTORS,X   95 57
061D        RTS             60


061E REM_SU 
061E STEPRT 

061E        LDY #$01        A0 01
0620        LDX #$03        A2 03
0622        STY TMP01       8C 5E 00

0625 STEPDO 
0625        LDA #$00        A9 00
0627        LDA *ROTORS,X   B5 57
0629        NOP             EA

062A        PHA             48
062B        CMP #$09        C9 09
062D        BNE STEPSK      D0 11

062F        LDA *ENIGV1     A5 4F
0631        CMP #$00        C9 00
0633        BNE STEPGR      D0 07

0635        CPX #$00        E0 00
0637        BEQ STEPSK      F0 07

0639        STY TMP01       8C 5E 00

063C STEPGR 

063C        INC *TMP01      E6 5E
063E        INC *TMP01      E6 5E

0640 STEPSK 
0640        CLC             18
0641        ROR *TMP01      66 5E
0643        BCC STEPNI      90 05

0645        INC *ROTORS,X   F6 57
0647        JSR ROLLOV      20 0D 06

064A STEPNI 

064A        PLA             68
064B        CMP #$09        C9 09
064D        BEQ STEPCN      F0 06

064F        LDA *ENIGV1     A5 4F
0651        CMP #$00        C9 00
0653        BNE STEPEX      D0 08

0655 STEPCN 

0655        CPX #$00        E0 00
0657        BEQ STEPEX      F0 04

0659        DEX             CA

065A        JMP STEPDO      4C 25 06

065D STEPEX 

065D        RTS             60


065E REM_SU 

065E CALL_W 

065E CALL_W 
065E ENRING 

065E        SEC             38
065F        ADC *ROTORS,X   75 57
0661 REM_PL 
0661        CMP #$0A        C9 0A
0663        BCC ENRIK1      90 02
0665 REM_AB 
0665        SBC #$0A        E9 0A
0667 REM_CA 

0667 ENRIK1 
0667        SEC             38
0668        SBC *RINGST,X   F5 53
066A        BCS ENRIK2      B0 02
066C        ADC #$0A        69 0A

066E ENRIK2 
066E        CLC             18
066F        RTS             60


0670 REM_SU 
0670 ENIGMA 

0670        LDA #$FF        A9 FF
0672        STA *TMP03      85 60

0674        LDA #$00        A9 00
0676        STA *TMP04      85 61

0678        LDY #$07        A0 07
067A        LDX #$03        A2 03
067C        LDA *KEYIN      A5 5B

067E ENIGM2 
067E        JSR ENRING      20 5E 06

0681        STX *TMP01      86 5E

0683        PHA             48
0684        TXA             8A
0685        CMP #$00        C9 00
0687        BEQ ENIGXO      F0 03

0689        LDA *ENIGV1,X   B5 4F
068B        TAX             AA

068C ENIGXO 
068C        PLA             68

068D        CLC             18
068E        ADC *TMP04      65 61
0690        ADC ROTIDX,X    7D 14 05
0693        TAX             AA
0694        LDA FWRTR1,X    BD 18 05

0697        PHA             48
0698        LDA #$00        A9 00
069A        LDX *TMP01      A6 5E
069C        JSR ENRING      20 5E 06
069F        STA *TMP02      85 5F
06A1        PLA             68

06A2        SEC             38
06A3        SBC *TMP02      E5 5F
06A5        BCS ENIGM3      B0 02
06A7        ADC #$0A        69 0A

06A9 ENIGM3 

06A9        STA *KEYOUT     85 5C

06AB        TYA             98

06AC        CMP #$04        C9 04
06AE        BNE ENIGNB      D0 08


06B0 REM_SE 

06B0        LDA #$01        A9 01
06B2        STA *TMP03      85 60

06B4        LDA #$28        A9 28
06B6        STA *TMP04      85 61

06B8 ENIGNB 

06B8        TXA             8A
06B9        CLC             18
06BA        ADC *TMP03      65 60
06BC        TAX             AA

06BD        LDA *KEYOUT     A5 5C

06BF        DEY             88
06C0        BNE ENIGM2      D0 BC

06C2        RTS             60

06C3        NOP             EA
done.
